<!doctype html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HC Sigorta - Supabase Test</title>

    <!-- Supabase CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />

    <style>
      .gradient-bg {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }
      .success {
        background: linear-gradient(135deg, #10b981 0%, #34d399 100%);
      }
      .error {
        background: linear-gradient(135deg, #ef4444 0%, #f87171 100%);
      }
      .info {
        background: linear-gradient(135deg, #3b82f6 0%, #60a5fa 100%);
      }
    </style>
  </head>
  <body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8">
      <div class="max-w-4xl mx-auto">
        <!-- Header -->
        <div class="gradient-bg text-white rounded-2xl p-8 mb-8 shadow-xl">
          <h1 class="text-3xl font-bold mb-2">
            HC Sigorta - Supabase Entegrasyon Testi
          </h1>
          <p class="text-lg opacity-90">
            Supabase bağlantısını test edin ve sistemi yapılandırın
          </p>
        </div>

        <!-- Supabase Config -->
        <div class="bg-white rounded-2xl p-6 shadow-lg mb-8">
          <h2 class="text-xl font-bold mb-4 text-gray-800">
            <i class="fas fa-cog text-blue-600 mr-2"></i>Supabase Yapılandırması
          </h2>

          <div class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1"
                >Project URL</label
              >
              <input
                type="text"
                id="supabaseUrl"
                value="https://cdjhtcntbnfdzmjnrhrf.supabase.co"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              />
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1"
                >Anon/Public Key</label
              >
              <input
                type="text"
                id="supabaseKey"
                value="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNkamh0Y250Ym5mZHptam5yaHJmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgyMjQ2OTYsImV4cCI6MjA3MzgwMDY5Nn0.o7uXImEIULZQ-KTAPLjNTbiDcmd1GVM34slCJQtU6X8"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              />
            </div>

            <button
              onclick="testConnection()"
              class="bg-blue-600 text-white px-6 py-2 rounded-lg font-semibold hover:bg-blue-700 transition-colors"
            >
              <i class="fas fa-plug mr-2"></i>Bağlantıyı Test Et
            </button>
          </div>
        </div>
        <!-- Test Results -->
        <div id="testResults" class="hidden">
          <div class="bg-white rounded-2xl p-6 shadow-lg mb-8">
            <h2 class="text-xl font-bold mb-4 text-gray-800">
              <i class="fas fa-check-circle text-green-600 mr-2"></i>Test
              Sonuçları
            </h2>
            <div id="resultsContent" class="space-y-3">
              <!-- Test sonuçları buraya gelecek -->
            </div>
          </div>
        </div>

        <!-- Quick Actions -->
        <div id="quickActions" class="hidden">
          <div class="bg-white rounded-2xl p-6 shadow-lg">
            <h2 class="text-xl font-bold mb-4 text-gray-800">
              <i class="fas fa-rocket text-purple-600 mr-2"></i>Hızlı İşlemler
            </h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <button
                onclick="runSQLScript()"
                class="bg-gradient-to-r from-purple-600 to-purple-700 text-white px-6 py-3 rounded-lg font-semibold hover:from-purple-700 hover:to-purple-800 transition-all"
              >
                <i class="fas fa-database mr-2"></i>SQL Script'i Çalıştır
              </button>

              <button
                onclick="createDemoUsers()"
                class="bg-gradient-to-r from-green-600 to-green-700 text-white px-6 py-3 rounded-lg font-semibold hover:from-green-700 hover:to-green-800 transition-all"
              >
                <i class="fas fa-users mr-2"></i>Demo Kullanıcıları Oluştur
              </button>

              <button
                onclick="testLogin()"
                class="bg-gradient-to-r from-blue-600 to-blue-700 text-white px-6 py-3 rounded-lg font-semibold hover:from-blue-700 hover:to-blue-800 transition-all"
              >
                <i class="fas fa-sign-in-alt mr-2"></i>Giriş Test Et
              </button>

              <button
                onclick="generateConfig()"
                class="bg-gradient-to-r from-orange-600 to-orange-700 text-white px-6 py-3 rounded-lg font-semibold hover:from-orange-700 hover:to-orange-800 transition-all"
              >
                <i class="fas fa-code mr-2"></i>Config Oluştur
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Supabase Integration Module -->
    <script src="supabase-entegrasyon.js"></script>

    <script>
      let supabase = null;

      // Test bağlantı
      async function testConnection() {
        const url = document.getElementById('supabaseUrl').value;
        const key = document.getElementById('supabaseKey').value;

        if (!url || !key) {
          showResult('Lütfen tüm alanları doldurun!', 'error');
          return;
        }

        try {
          // Supabase client oluştur
          supabase = window.supabase.createClient(url, key);

          // Basit bir test sorgusu
          const { data, error } = await supabase
            .from('firmalar')
            .select('count')
            .single();

          if (error && error.code !== 'PGRST116') {
            throw error;
          }

          showResult('✅ Supabase bağlantısı başarılı!', 'success');
          document.getElementById('testResults').classList.remove('hidden');
          document.getElementById('quickActions').classList.remove('hidden');

          // Config'i localStorage'a kaydet
          localStorage.setItem('supabase_url', url);
          localStorage.setItem('supabase_key', key);
        } catch (error) {
          showResult(`❌ Bağlantı hatası: ${error.message}`, 'error');
        }
      }

      // Sonuç göster
      function showResult(message, type) {
        const resultsContent = document.getElementById('resultsContent');
        const alertClass =
          type === 'success'
            ? 'bg-green-100 text-green-800'
            : type === 'error'
              ? 'bg-red-100 text-red-800'
              : 'bg-blue-100 text-blue-800';

        const alert = document.createElement('div');
        alert.className = `p-4 rounded-lg ${alertClass} mb-2`;
        alert.innerHTML = message;
        resultsContent.appendChild(alert);
      }
      // SQL Script'i çalıştır
      async function runSQLScript() {
        showResult(
          "📝 SQL script'i Supabase Dashboard'dan SQL Editor'e gidin ve supabase_setup.sql dosyasını çalıştırın.",
          'info'
        );
        window.open('https://app.supabase.com/project/_/sql/new', '_blank');
      }

      // Demo kullanıcıları oluştur
      async function createDemoUsers() {
        showResult(
          '👥 Demo kullanıcıları Supabase Dashboard > Authentication > Users bölümünden ekleyin.',
          'info'
        );
        showResult(
          `
                <strong>Admin Kullanıcı:</strong><br>
                Email: admin@hcsigorta.com<br>
                Şifre: 123456<br>
                Role: admin<br><br>
                <strong>Test Kullanıcı:</strong><br>
                Email: teknoloji@hcsigorta.com<br>
                Şifre: 123456<br>
                Role: user
            `,
          'info'
        );
      }

      // Giriş test
      async function testLogin() {
        try {
          const { data, error } = await supabase.auth.signInWithPassword({
            email: 'admin@hcsigorta.com',
            password: '123456',
          });

          if (error) throw error;

          showResult('✅ Giriş testi başarılı! Kullanıcı bulundu.', 'success');
          await supabase.auth.signOut();
        } catch (error) {
          showResult(`❌ Giriş testi başarısız: ${error.message}`, 'error');
          showResult(
            '💡 Önce demo kullanıcıları oluşturmanız gerekiyor.',
            'info'
          );
        }
      }

      // Config oluştur
      function generateConfig() {
        const url = localStorage.getItem('supabase_url');
        const key = localStorage.getItem('supabase_key');

        if (!url || !key) {
          showResult('❌ Önce bağlantıyı test edin!', 'error');
          return;
        }

        const config = `
<strong>index.html dosyasında şu satırları güncelleyin:</strong><br><br>
<code style="background: #f3f4f6; padding: 8px; border-radius: 4px; display: block; margin: 8px 0;">
const SUPABASE_URL = '${url}';<br>
const SUPABASE_ANON_KEY = '${key}';
</code>
            `;

        showResult(config, 'success');
      }

      // Sayfa yüklendiğinde
      window.addEventListener('DOMContentLoaded', () => {
        // Kaydedilmiş config varsa yükle
        const savedUrl = localStorage.getItem('supabase_url');
        const savedKey = localStorage.getItem('supabase_key');

        if (savedUrl) document.getElementById('supabaseUrl').value = savedUrl;
        if (savedKey) document.getElementById('supabaseKey').value = savedKey;
      });
    </script>
  </body>
</html>

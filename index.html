<!doctype html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HC Grup - Çok Firmalı Personel Yönetim Sistemi</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
      }

      .container {
        max-width: 1900px;
        margin: 0 auto;
        padding: 20px;
      }

      .header {
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        text-align: center;
        margin-bottom: 30px;
      }

      .header h1 {
        color: #333;
        margin-bottom: 10px;
        font-size: 2em;
      }

      .header p {
        color: #666;
        font-size: 14px;
      }

      /* Firma Renk Kodları */
      .firma-hc-klinik {
        background: #e8f5e9;
        border-left: 5px solid #4caf50;
      }
      .firma-hc-lab {
        background: #e3f2fd;
        border-left: 5px solid #2196f3;
      }
      .firma-hc-eczane {
        background: #fff3e0;
        border-left: 5px solid #ff9800;
      }
      .firma-hc-dental {
        background: #fce4ec;
        border-left: 5px solid #e91e63;
      }
      .firma-hc-goz {
        background: #f3e5f5;
        border-left: 5px solid #9c27b0;
      }
      .firma-hc-fizyo {
        background: #e0f2f1;
        border-left: 5px solid #009688;
      }
      .firma-hc-diyetisyen {
        background: #fffde7;
        border-left: 5px solid #ffeb3b;
      }
      .firma-hc-radyoloji {
        background: #ffebee;
        border-left: 5px solid #f44336;
      }
      .firma-hc-ambulans {
        background: #f1f8e9;
        border-left: 5px solid #8bc34a;
      }
      .firma-hc-temizlik {
        background: #e8eaf6;
        border-left: 5px solid #3f51b5;
      }

      /* Sekmeler */
      .tabs {
        background: white;
        border-radius: 10px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
      }

      .tab-buttons {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 2px;
        padding: 10px;
        background: #f8f9fa;
        border-radius: 10px 10px 0 0;
      }

      .tab-button {
        padding: 12px 8px;
        background: #ffffff;
        border: 2px solid transparent;
        cursor: pointer;
        font-size: 11px;
        font-weight: bold;
        color: white !important;
        text-shadow: 0 1px 3px rgba(0, 0, 0, 0.7);
        transition: all 0.3s ease;
        border-radius: 8px;
        text-align: center;
        min-height: 60px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .tab-button.active {
        color: white !important;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      }

      /* Her firma için renk */
      .tab-button[data-firma='ana-sayfa'] {
        background: linear-gradient(135deg, #333 0%, #666 100%);
        color: white !important;
      }
      .tab-button[data-firma='hc-klinik'] {
        background: linear-gradient(135deg, #4caf50 0%, #2e7d32 100%);
        color: white !important;
      }
      .tab-button[data-firma='hc-lab'] {
        background: linear-gradient(135deg, #2196f3 0%, #1565c0 100%);
        color: white !important;
      }
      .tab-button[data-firma='hc-eczane'] {
        background: linear-gradient(135deg, #ff9800 0%, #e65100 100%);
        color: white !important;
      }
      .tab-button[data-firma='hc-dental'] {
        background: linear-gradient(135deg, #e91e63 0%, #ad1457 100%);
        color: white !important;
      }
      .tab-button[data-firma='hc-goz'] {
        background: linear-gradient(135deg, #9c27b0 0%, #6a1b9a 100%);
        color: white !important;
      }
      .tab-button[data-firma='hc-fizyo'] {
        background: linear-gradient(135deg, #009688 0%, #00695c 100%);
        color: white !important;
      }
      .tab-button[data-firma='hc-diyetisyen'] {
        background: linear-gradient(135deg, #ffeb3b 0%, #f57f17 100%);
        color: #333 !important;
        text-shadow: 0 1px 2px rgba(255, 255, 255, 0.8);
      }
      .tab-button[data-firma='hc-radyoloji'] {
        background: linear-gradient(135deg, #f44336 0%, #c62828 100%);
        color: white !important;
      }
      .tab-button[data-firma='hc-ambulans'] {
        background: linear-gradient(135deg, #8bc34a 0%, #558b2f 100%);
        color: white !important;
      }
      .tab-button[data-firma='hc-temizlik'] {
        background: linear-gradient(135deg, #3f51b5 0%, #283593 100%);
        color: white !important;
      }

      /* Özel sekmeler için renkler */
      .tab-button[data-firma='tum-personel'] {
        background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
        color: white !important;
      }
      .tab-button[data-firma='yonetim-paneli'] {
        background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
        color: white !important;
      }
      .tab-button[data-firma='yeni-personel'] {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        color: white !important;
      }
      .tab-button[data-firma='kullanici-ayarlari'] {
        background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        color: #333 !important;
        text-shadow: 0 1px 2px rgba(255, 255, 255, 0.8);
      }

      /* Sarı sekmeler için özel hover kuralları */
      .tab-button[data-firma='hc-diyetisyen']:hover,
      .tab-button[data-firma='kullanici-ayarlari']:hover {
        color: #333 !important;
        text-shadow: 0 1px 2px rgba(255, 255, 255, 0.8);
      }

      /* Ultra güçlü kural - Tüm durumları kapsamak için */
      .tab-button:not([data-firma='hc-diyetisyen']):not(
          [data-firma='kullanici-ayarlari']
        ) {
        color: white !important;
      }

      /* Aktif olmayan durumlar için de güçlendirme */
      .tab-button:not(.active):not([data-firma='hc-diyetisyen']):not(
          [data-firma='kullanici-ayarlari']
        ) {
        color: white !important;
      }

      .tab-button:hover {
        color: white !important;
        transform: translateY(-3px);
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
      }

      .tab-content {
        background: white;
        padding: 30px;
        border-radius: 0 0 10px 10px;
        min-height: 700px;
      }

      .tab-pane {
        display: none;
      }

      .tab-pane.active {
        display: block;
      }

      /* Personel Tablosu */
      .personel-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
        background: white;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        font-size: 14px;
      }

      .personel-table th {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 15px 12px;
        text-align: center;
        font-weight: 600;
        font-size: 14px;
        line-height: 1.2;
      }

      .personel-table td {
        padding: 12px 10px;
        border-bottom: 1px solid #eee;
        font-size: 14px;
        text-align: center;
      }

      .personel-table tbody tr:hover {
        background: #f8f9ff;
        cursor: pointer;
      }

      .ucret-input,
      .gun-input {
        width: 70px;
        padding: 6px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
        text-align: center;
      }

      .hesaplanan {
        font-weight: 600;
        color: #333;
      }

      .pozitif {
        color: #28a745;
        font-weight: 600;
      }

      .negatif {
        color: #dc3545;
        font-weight: 600;
      }

      /* Ana Sayfa Özet Stilleri */
      .ana-sayfa-ozet {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .firma-ozet-kart {
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        position: relative;
      }

      .firma-ozet-kart h3 {
        margin-bottom: 15px;
        font-size: 16px;
        color: #333;
      }

      .ozet-bilgi {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        font-size: 12px;
      }

      .ozet-bilgi div {
        background: rgba(255, 255, 255, 0.8);
        padding: 8px;
        border-radius: 6px;
      }

      .toplam-tablo {
        margin-top: 30px;
        background: white;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
      }

      .toplam-tablo h3 {
        background: linear-gradient(135deg, #333 0%, #666 100%);
        color: white;
        padding: 20px;
        margin: 0;
        font-size: 18px;
        text-align: center;
      }

      /* Yeni Personel Formu */
      .yeni-personel-form {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      }

      .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 20px;
      }

      .form-group label {
        display: block;
        margin-bottom: 8px;
        color: #333;
        font-weight: 600;
      }

      .form-group input,
      .form-group select,
      .form-group textarea {
        width: 100%;
        padding: 12px;
        border: 2px solid #ddd;
        border-radius: 8px;
        font-size: 14px;
        transition: border-color 0.3s ease;
      }

      .form-group input:focus,
      .form-group select:focus,
      .form-group textarea:focus {
        outline: none;
        border-color: #667eea;
      }

      .btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 15px 30px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 16px;
        font-weight: 600;
        transition: transform 0.3s ease;
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4);
      }

      .section-title {
        color: #333;
        margin-bottom: 25px;
        padding-bottom: 15px;
        border-bottom: 3px solid #667eea;
        font-size: 20px;
      }

      /* Mobil Responsive Tasarım */
      @media (max-width: 1024px) {
        .container {
          margin: 10px;
          padding: 15px;
        }

        .tab-buttons {
          grid-template-columns: repeat(4, 1fr);
          gap: 1px;
        }

        .tab-button {
          font-size: 10px;
          padding: 8px 4px;
        }

        .asgari-ucret-panel {
          grid-template-columns: 1fr !important;
          gap: 10px !important;
        }

        .stat-cards {
          grid-template-columns: repeat(2, 1fr) !important;
        }
      }

      @media (max-width: 768px) {
        .container {
          margin: 5px;
          padding: 10px;
        }

        .header h1 {
          font-size: 18px;
        }

        .tab-buttons {
          grid-template-columns: repeat(3, 1fr);
          gap: 1px;
        }

        .tab-button {
          font-size: 9px;
          padding: 6px 2px;
          min-height: 50px;
        }

        .personel-table {
          font-size: 11px;
          display: block;
          overflow-x: auto;
          white-space: nowrap;
        }

        .personel-table th,
        .personel-table td {
          padding: 6px 3px;
        }

        .ucret-input,
        .gun-input {
          width: 60px;
          font-size: 10px;
        }

        .stat-cards {
          grid-template-columns: 1fr !important;
          gap: 8px;
        }

        .stat-card {
          padding: 10px;
        }

        .form-row {
          flex-direction: column;
        }

        .form-group {
          margin-bottom: 15px;
        }

        .section-title {
          font-size: 16px;
        }

        .asgari-ucret-panel {
          padding: 15px !important;
        }

        .asgari-ucret-panel h3 {
          font-size: 14px !important;
        }
      }

      @media (max-width: 480px) {
        .tab-buttons {
          grid-template-columns: repeat(2, 1fr);
        }

        .tab-button {
          font-size: 8px;
          padding: 4px 2px;
          min-height: 45px;
        }

        .header h1 {
          font-size: 16px;
        }

        .personel-table {
          font-size: 10px;
        }

        .btn {
          padding: 6px 8px;
          font-size: 10px;
        }

        .container {
          padding: 8px;
          margin: 2px;
        }

        .evrak-upload-section {
          grid-template-columns: 1fr !important;
        }
      }

      /* İstatistik kartları */
      .stat-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 30px;
      }

      .stat-card {
        background: white;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        text-align: center;
        border-left: 5px solid #667eea;
      }

      .stat-card h4 {
        color: #667eea;
        font-size: 24px;
        margin-bottom: 8px;
      }

      .stat-card p {
        color: #666;
        font-size: 14px;
      }

      /* Login Modal */
      .login-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        z-index: 1000;
        justify-content: center;
        align-items: center;
      }

      .login-modal.active {
        display: flex;
      }

      .login-form {
        background: white;
        padding: 40px;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        text-align: center;
        max-width: 400px;
        width: 90%;
      }

      .login-form h2 {
        margin-bottom: 30px;
        color: #333;
      }

      .login-form input {
        width: 100%;
        padding: 15px;
        margin-bottom: 20px;
        border: 2px solid #ddd;
        border-radius: 8px;
        font-size: 16px;
      }

      .login-form input:focus {
        outline: none;
        border-color: #667eea;
      }

      .login-form button {
        width: 100%;
        padding: 15px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.3s ease;
      }

      .login-form button:hover {
        transform: translateY(-2px);
      }

      .logout-btn {
        position: absolute;
        top: 20px;
        right: 20px;
        background: #dc3545;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
      }

      .logout-btn:hover {
        background: #c82333;
      }
    </style>
  </head>
  <body>
    <!-- Login Modal -->
    <div id="loginModal" class="login-modal active">
      <div class="login-form">
        <h2>🏥 HC GRUP GİRİŞ</h2>
        <p style="margin-bottom: 20px; color: #666">
          Şirket seçimi yapın ve giriş yapın
        </p>

        <select
          id="firmaSelect"
          style="
            width: 100%;
            padding: 15px;
            margin-bottom: 20px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
          "
        >
          <option value="">Şirket Seçin</option>
          <option value="admin">🔑 SİSTEM YÖNETİCİSİ</option>
          <option value="hc-klinik">🏥 HC KLİNİK</option>
          <option value="hc-lab">🧪 HC LAB</option>
          <option value="hc-eczane">💊 HC ECZANE</option>
          <option value="hc-dental">🦷 HC DENTAL</option>
          <option value="hc-goz">👁️ HC GÖZ</option>
          <option value="hc-fizyo">🏃 HC FİZYOTERAPİ</option>
          <option value="hc-diyetisyen">🥗 HC DİYETİSYEN</option>
          <option value="hc-radyoloji">📡 HC RADYOLOJİ</option>
          <option value="hc-ambulans">🚑 HC AMBULANS</option>
          <option value="hc-temizlik">🧹 HC TEMİZLİK</option>
        </select>

        <input type="text" id="username" placeholder="Kullanıcı Adı" required />

        <!-- Basit Şifre Input -->
        <div style="position: relative; margin-bottom: 20px">
          <input
            type="password"
            id="password"
            placeholder="Şifre"
            required
            style="
              width: 100%;
              padding: 15px;
              margin-bottom: 0;
              border: 2px solid #ddd;
              border-radius: 8px;
              font-size: 16px;
              padding-right: 45px;
            "
          />
          <span
            onclick="togglePassword()"
            style="
              position: absolute;
              right: 15px;
              top: 15px;
              cursor: pointer;
              font-size: 18px;
              user-select: none;
            "
            title="Şifreyi göster/gizle"
          >
            👁️
          </span>
        </div>

        <!-- Şifre Hatırlatması -->
        <div
          style="
            font-size: 12px;
            color: #666;
            margin-bottom: 15px;
            text-align: center;
            background: #f8f9fa;
            padding: 8px;
            border-radius: 5px;
          "
        >
          💡 <strong>Admin:</strong> admin123 |
          <strong>Şirketler:</strong> 123456
        </div>
        <button onclick="login()">Giriş Yap</button>

        <div style="margin-top: 20px; font-size: 12px; color: #999">
          <p><strong>Demo Giriş Bilgileri:</strong></p>
          <p>Admin: admin / admin123</p>
          <p>Şirketler: [şirket_adı] / 123456</p>
          <p style="font-size: 10px; margin-top: 5px">
            Örnek: klinik/123456, lab/123456, eczane/123456
          </p>
        </div>
      </div>
    </div>

    <div class="container">
      <button class="logout-btn" onclick="logout()">Çıkış Yap</button>

      <div class="header">
        <h1>HC GRUP ŞİRKETLERİ</h1>
        <p>Çok Firmalı Personel Yönetim Sistemi - 10 Alt Şirket + Ana Toplam</p>
        <p style="font-size: 12px; color: #999">
          Sınırsız Personel Kapasitesi - Gerçek Zamanlı Hesaplama
        </p>
        <p
          id="currentUser"
          style="
            font-size: 14px;
            color: #667eea;
            font-weight: 600;
            margin-top: 10px;
          "
        ></p>
      </div>

      <!-- Sekmeler -->
      <div class="tabs">
        <div class="tab-buttons" id="tabButtons">
          <!-- Sekmeler JavaScript ile doldurulacak -->
        </div>

        <div class="tab-content" id="tabContent">
          <!-- İçerik JavaScript ile doldurulacak -->
        </div>
      </div>
    </div>

    <script>
      // Sistem durumu
      let currentUser = null;
      let currentFirma = null;
      let isAdmin = false;

      // Excel formülleri (ana dosyada saklanıyor)
      const VERGI_ORANLARI = {
        gelirVergisi: 0.2, // %20
        sskIsci: 0.15, // %15 (SSK İşçi %14 + İşsizlik %1)
        sskIsveren: 0.3775, // %37.75 (İşveren SSK maliyeti)
        damgaVergisi: 0.0076, // %0.76
        muhasebeParasi: 50, // 50₺ sabit
      };

      // Firma verileri (sınırsız personel kapasiteli)
      const firmaPersonelleri = {
        'hc-klinik': [
          {
            id: 'p1',
            isim: 'Dr. Ahmet Yılmaz',
            pozisyon: 'Uzman Doktor',
            brutMaas: 80000,
            calistigiGun: 22,
          },
          {
            id: 'p2',
            isim: 'Ayşe Hemşire',
            pozisyon: 'Hemşire',
            brutMaas: 35000,
            calistigiGun: 25,
          },
          {
            id: 'p3',
            isim: 'Mehmet Teknisyen',
            pozisyon: 'Tıbbi Tekniker',
            brutMaas: 28000,
            calistigiGun: 20,
          },
        ],
        'hc-lab': [
          {
            id: 'p4',
            isim: 'Fatma Laborant',
            pozisyon: 'Biyomedikal Uzman',
            brutMaas: 32000,
            calistigiGun: 22,
          },
          {
            id: 'p5',
            isim: 'Ali Analist',
            pozisyon: 'Laboratuvar Teknisyeni',
            brutMaas: 26000,
            calistigiGun: 25,
          },
        ],
        'hc-eczane': [
          {
            id: 'p6',
            isim: 'Zeynep Eczacı',
            pozisyon: 'Eczacı',
            brutMaas: 45000,
            calistigiGun: 26,
          },
          {
            id: 'p7',
            isim: 'Can Teknisyen',
            pozisyon: 'Eczane Teknisyeni',
            brutMaas: 24000,
            calistigiGun: 24,
          },
        ],
        'hc-dental': [
          {
            id: 'p8',
            isim: 'Dr. Selin Diş',
            pozisyon: 'Diş Hekimi',
            brutMaas: 65000,
            calistigiGun: 20,
          },
        ],
        'hc-goz': [
          {
            id: 'p9',
            isim: 'Dr. Kemal Göz',
            pozisyon: 'Göz Doktoru',
            brutMaas: 70000,
            calistigiGun: 18,
          },
        ],
        'hc-fizyo': [
          {
            id: 'p10',
            isim: 'Elif Fizyoterapist',
            pozisyon: 'Fizyoterapist',
            brutMaas: 38000,
            calistigiGun: 25,
          },
        ],
        'hc-diyetisyen': [
          {
            id: 'p11',
            isim: 'Merve Diyetisyen',
            pozisyon: 'Diyetisyen',
            brutMaas: 30000,
            calistigiGun: 20,
          },
        ],
        'hc-radyoloji': [
          {
            id: 'p12',
            isim: 'Dr. Burak Radyo',
            pozisyon: 'Radyolog',
            brutMaas: 75000,
            calistigiGun: 22,
          },
        ],
        'hc-ambulans': [
          {
            id: 'p13',
            isim: 'Murat Paramedik',
            pozisyon: 'Paramedik',
            brutMaas: 30000,
            calistigiGun: 25,
          },
          {
            id: 'p14',
            isim: 'Oğuz Şoför',
            pozisyon: 'Ambulans Şoförü',
            brutMaas: 22000,
            calistigiGun: 26,
          },
        ],
        'hc-temizlik': [
          {
            id: 'p15',
            isim: 'Hatice Temizlik',
            pozisyon: 'Temizlik Görevlisi',
            brutMaas: 17002,
            calistigiGun: 26,
          },
        ],
      };

      // Firma bilgileri
      const firmaConfig = {
        'hc-klinik': { name: '🏥 HC KLİNİK', color: '#4caf50' },
        'hc-lab': { name: '🧪 HC LAB', color: '#2196f3' },
        'hc-eczane': { name: '💊 HC ECZANE', color: '#ff9800' },
        'hc-dental': { name: '🦷 HC DENTAL', color: '#e91e63' },
        'hc-goz': { name: '👁️ HC GÖZ', color: '#9c27b0' },
        'hc-fizyo': { name: '🏃 HC FİZYO', color: '#009688' },
        'hc-diyetisyen': { name: '🥗 HC DİYET', color: '#ffeb3b' },
        'hc-radyoloji': { name: '📡 HC RADYO', color: '#f44336' },
        'hc-ambulans': { name: '🚑 HC AMBULANS', color: '#8bc34a' },
        'hc-temizlik': { name: '🧹 HC TEMİZLİK', color: '#3f51b5' },
      };

      // Asgari Ücret Konfigürasyonu (2024)
      let asgariUcretConfig = {
        brutAsgariUcret: 17002.12, // 2024 asgari ücreti
        netAsgariUcret: 13414.58, // Muafiyetlerle birlikte net
        muafiyetMiktari: 3587.54, // Brüt - Net farkı (işveren maliyeti)
        guncellemeZamani: new Date().toLocaleDateString('tr-TR'),
      };

      // Evrak Yönetim Sistemi
      let personelEvraklari = {}; // personelId: {evrakTuru: {dosya, yuklenmeTarihi, yukleyenFirma}}

      const evrakTurleri = {
        kimlikBelgesi: {
          name: 'Kimlik Belgesi',
          icon: '🆔',
          required: true,
          accept: '.pdf,.jpg,.jpeg,.png',
        },
        diplomaBelgesi: {
          name: 'Diploma/Mezuniyet Belgesi',
          icon: '🎓',
          required: false,
          accept: '.pdf,.jpg,.jpeg,.png',
        },
        adliSicilKaydi: {
          name: 'Adli Sicil Kaydı',
          icon: '📋',
          required: true,
          accept: '.pdf,.jpg,.jpeg,.png',
        },
        saglikRaporu: {
          name: 'Sağlık Raporu',
          icon: '🏥',
          required: false,
          accept: '.pdf,.jpg,.jpeg,.png',
        },
        digerEvraklar: {
          name: 'Diğer Evraklar',
          icon: '📄',
          required: false,
          accept: '.pdf,.jpg,.jpeg,.png,.doc,.docx',
        },
      };

      // Giriş sistemi
      function login() {
        const firma = document.getElementById('firmaSelect').value;
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;

        if (!firma || !username || !password) {
          alert('Lütfen tüm alanları doldurun!');
          return;
        }

        // Demo giriş kontrolleri
        console.log('Giriş denemesi:', { firma, username, password });

        // Admin girişi
        if (
          firma === 'admin' &&
          username === 'admin' &&
          password === 'admin123'
        ) {
          currentUser = 'Sistem Yöneticisi';
          currentFirma = 'admin';
          isAdmin = true;
        }
        // Şirket girişleri - tüm kombinasyonlar
        else if (password === '123456') {
          const validLogins = {
            'hc-klinik': ['klinik', 'hc-klinik'],
            'hc-lab': ['lab', 'hc-lab'],
            'hc-eczane': ['eczane', 'hc-eczane'],
            'hc-dental': ['dental', 'hc-dental'],
            'hc-goz': ['goz', 'hc-goz'],
            'hc-fizyo': ['fizyo', 'hc-fizyo'],
            'hc-diyetisyen': ['diyetisyen', 'hc-diyetisyen'],
            'hc-radyoloji': ['radyoloji', 'hc-radyoloji'],
            'hc-ambulans': ['ambulans', 'hc-ambulans'],
            'hc-temizlik': ['temizlik', 'hc-temizlik'],
          };

          if (validLogins[firma] && validLogins[firma].includes(username)) {
            currentUser = firmaConfig[firma].name + ' Kullanıcısı';
            currentFirma = firma;
            isAdmin = false;
          } else {
            const expectedUsernames = validLogins[firma]
              ? validLogins[firma].join(' veya ')
              : 'bilinmiyor';
            alert(
              `Hatalı kullanıcı adı! ${firma} için kullanıcı adı: ${expectedUsernames}`
            );
            return;
          }
        } else {
          alert('Hatalı şifre! Şirketler için: 123456, Admin için: admin123');
          return;
        }

        document.getElementById('loginModal').classList.remove('active');
        document.getElementById('currentUser').textContent =
          `Hoş geldiniz: ${currentUser}`;
        initializeApp();
      }

      function logout() {
        currentUser = null;
        currentFirma = null;
        isAdmin = false;
        document.getElementById('loginModal').classList.add('active');
        document.getElementById('firmaSelect').value = '';
        document.getElementById('username').value = '';
        document.getElementById('password').value = '';
      }

      // Basit şifre göster/gizle
      function togglePassword() {
        const passwordInput = document.getElementById('password');
        const toggleButton = passwordInput.nextElementSibling;

        if (passwordInput.type === 'password') {
          passwordInput.type = 'text';
          toggleButton.innerHTML = '🙈';
        } else {
          passwordInput.type = 'password';
          toggleButton.innerHTML = '👁️';
        }
      }

      // Maaş hesaplama (Excel formülleri)
      function hesaplaMaas(brutMaas, calistigiGun, isAsgariUcret = false) {
        const aylikGun = 30;
        const oranliMaas = (brutMaas / aylikGun) * calistigiGun;

        // Asgari ücret muafiyeti kontrolü
        if (isAsgariUcret) {
          // Asgari ücrette muafiyet var - net ücret sabit kalır
          const oranliNetAsgari =
            (asgariUcretConfig.netAsgariUcret / aylikGun) * calistigiGun;
          const isverenMaliyetFarki =
            (asgariUcretConfig.muafiyetMiktari / aylikGun) * calistigiGun;

          return {
            oranliMaas,
            sskIsci: 0, // Muafiyetli
            sskIsveren: 0, // Muafiyetli
            gelirVergisi: 0, // Muafiyetli
            damgaVergisi: 0, // Muafiyetli
            muhasebeParasi: VERGI_ORANLARI.muhasebeParasi,
            netMaas: oranliNetAsgari,
            toplamIsciKesinti: 0,
            toplamIsverenMaliyet:
              isverenMaliyetFarki + VERGI_ORANLARI.muhasebeParasi,
            isAsgariUcret: true,
          };
        }

        // Normal maaş hesaplama
        const sskIsci = oranliMaas * VERGI_ORANLARI.sskIsci;
        const vergiMatrahi = oranliMaas - sskIsci;
        const gelirVergisi = vergiMatrahi * VERGI_ORANLARI.gelirVergisi;
        const damgaVergisi = oranliMaas * VERGI_ORANLARI.damgaVergisi;
        const sskIsveren = oranliMaas * VERGI_ORANLARI.sskIsveren;
        const muhasebeParasi = VERGI_ORANLARI.muhasebeParasi;

        const netMaas = oranliMaas - sskIsci - gelirVergisi - damgaVergisi;
        const toplamIsciKesinti = sskIsci + gelirVergisi + damgaVergisi;
        // Excel formülü: =SSKİşveren+GelirVergisi+DamgaVergisi+MuhasebeParası
        const toplamIsverenMaliyet =
          sskIsveren + gelirVergisi + damgaVergisi + muhasebeParasi;

        return {
          oranliMaas,
          sskIsci,
          sskIsveren,
          gelirVergisi,
          damgaVergisi,
          muhasebeParasi,
          netMaas,
          toplamIsciKesinti,
          toplamIsverenMaliyet,
          isAsgariUcret: false,
        };
      }

      // Asgari ücret ayarları fonksiyonları
      function updateAsgariUcret() {
        const brut =
          parseFloat(document.getElementById('brutAsgariUcret').value) || 0;
        const net =
          parseFloat(document.getElementById('netAsgariUcret').value) || 0;
        const fark = brut - net;

        document.getElementById('muafiyetMiktari').value = fark.toFixed(2);

        // Global değişkeni güncelle
        asgariUcretConfig.brutAsgariUcret = brut;
        asgariUcretConfig.netAsgariUcret = net;
        asgariUcretConfig.muafiyetMiktari = fark;
      }

      function kaydetAsgariUcret() {
        updateAsgariUcret();
        asgariUcretConfig.guncellemeZamani = new Date().toLocaleDateString(
          'tr-TR'
        );
        document.getElementById('asgariUcretGuncelleme').textContent =
          asgariUcretConfig.guncellemeZamani;

        addActivityLog(
          `Asgari ücret güncellendi: ₺${asgariUcretConfig.netAsgariUcret} (Net), ₺${asgariUcretConfig.brutAsgariUcret} (Brüt)`
        );
        alert(`✅ Asgari ücret ayarları kaydedildi!
💰 Brüt: ₺${asgariUcretConfig.brutAsgariUcret.toFixed(2)}
💵 Net: ₺${asgariUcretConfig.netAsgariUcret.toFixed(2)}
🏢 İşveren Maliyet Farkı: ₺${asgariUcretConfig.muafiyetMiktari.toFixed(2)}

🔄 Tüm asgari ücretli personellerin maaşları otomatik güncellenecek!`);

        // Mevcut tabloları yenile
        if (typeof updateAnaSayfa === 'function') updateAnaSayfa();
      }

      // PDF ve Yazdırma Fonksiyonları
      function yazdir() {
        // Sayfa yazdırma hazırlığı
        const printContent = document.getElementById('tabContent').innerHTML;
        const printWindow = window.open('', '_blank');

        printWindow.document.write(`
          <html>
          <head>
            <title>HC Sigorta Bordro Raporu</title>
            <style>
              body { font-family: Arial, sans-serif; margin: 20px; }
              .stat-cards { display: flex; flex-wrap: wrap; gap: 15px; margin: 20px 0; }
              .stat-card { background: #f8f9fa; padding: 15px; border-radius: 8px; flex: 1; min-width: 200px; }
              .personel-table { width: 100%; border-collapse: collapse; margin: 20px 0; }
              .personel-table th, .personel-table td { border: 1px solid #ddd; padding: 8px; text-align: left; }
              .personel-table th { background: #f8f9fa; font-weight: bold; }
              .section-title { color: #333; border-bottom: 2px solid #007bff; padding-bottom: 10px; }
              .asgari-ucret-panel { display: none !important; }
              @media print { 
                button { display: none !important; }
                .asgari-ucret-panel { display: none !important; }
              }
            </style>
          </head>
          <body>
            <div style="text-align: center; margin-bottom: 30px;">
              <h1>🏥 HC SİGORTA BORDRO RAPORU</h1>
              <p>📅 Rapor Tarihi: ${new Date().toLocaleDateString('tr-TR')}</p>
              <hr>
            </div>
            ${printContent}
          </body>
          </html>
        `);

        printWindow.document.close();
        setTimeout(() => {
          printWindow.print();
          printWindow.close();
        }, 500);

        addActivityLog('Bordro raporu yazdırıldı');
      }

      function pdfKaydet() {
        // PDF kaydetme simülasyonu (gerçek uygulamada PDF.js kullanılabilir)
        alert(`📄 PDF Kaydetme Özelliği

🔄 PDF kaydediliyor...
📊 ${document.querySelectorAll('.personel-table tbody tr').length} personel verisi işleniyor
💰 ${document.querySelectorAll('.stat-card').length} istatistik dahil ediliyor

✅ PDF başarıyla kaydedilecek: 
📁 Dosya: HC_Sigorta_Bordro_${new Date().getFullYear()}-${(new Date().getMonth() + 1).toString().padStart(2, '0')}-${new Date().getDate().toString().padStart(2, '0')}.pdf

PDF dosyası başarıyla oluşturuldu ve indiriliyor.`);

        addActivityLog('Bordro raporu PDF olarak kaydedildi');
      }

      function excelKaydet() {
        // Excel kaydetme fonksiyonu
        const excelData = [];
        const tables = document.querySelectorAll('.personel-table');

        tables.forEach((table, index) => {
          const headers = Array.from(table.querySelectorAll('thead th')).map(
            (th) => th.textContent.trim()
          );
          const rows = Array.from(table.querySelectorAll('tbody tr')).map(
            (tr) =>
              Array.from(tr.querySelectorAll('td')).map((td) =>
                td.textContent.trim()
              )
          );

          excelData.push({
            sheetName: index === 0 ? 'Genel Özet' : `Tablo ${index + 1}`,
            headers,
            rows,
          });
        });

        // CSV formatında indirme simülasyonu
        let csvContent = '';
        excelData.forEach((sheet, sheetIndex) => {
          if (sheetIndex > 0) csvContent += '\\n\\n';
          csvContent += `=== ${sheet.sheetName} ===\\n`;
          csvContent += sheet.headers.join(',') + '\\n';
          sheet.rows.forEach((row) => {
            csvContent += row.join(',') + '\\n';
          });
        });

        const blob = new Blob([csvContent], {
          type: 'text/csv;charset=utf-8;',
        });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = `HC_Sigorta_Bordro_${new Date().getFullYear()}-${(new Date().getMonth() + 1).toString().padStart(2, '0')}-${new Date().getDate().toString().padStart(2, '0')}.csv`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);

        addActivityLog('Bordro raporu Excel/CSV olarak kaydedildi');
        alert(`📊 Excel/CSV dosyası başarıyla indirildi!
📁 ${excelData.length} sayfa veri
👥 ${excelData.reduce((sum, sheet) => sum + sheet.rows.length, 0)} personel kaydı`);
      }

      // Asgari ücret toggle fonksiyonları (Yeni personel ekleme sayfası için)
      function asgariUcretToggle() {
        const checkbox = document.getElementById('asgariUcretCheck');
        const brutMaasInput = document.getElementById('brutMaas');

        if (checkbox && checkbox.checked) {
          brutMaasInput.value = asgariUcretConfig.brutAsgariUcret;
          brutMaasInput.readOnly = true;
          brutMaasInput.style.background = '#fef3c7';
          brutMaasInput.style.border = '2px solid #fbbf24';
        } else {
          brutMaasInput.readOnly = false;
          brutMaasInput.style.background = 'white';
          brutMaasInput.style.border = '2px solid #ddd';
        }
      }

      function maasInputChange() {
        const brutMaasInput = document.getElementById('brutMaas');
        const checkbox = document.getElementById('asgariUcretCheck');

        if (
          checkbox &&
          checkbox.checked &&
          parseFloat(brutMaasInput.value) !== asgariUcretConfig.brutAsgariUcret
        ) {
          checkbox.checked = false;
          asgariUcretToggle();
        }
      }

      // Evrak Yönetim Fonksiyonları
      function handleFileUpload(evrakTuru, fileInput) {
        const files = Array.from(fileInput.files);
        const statusDiv = document.getElementById(`${evrakTuru}-status`);
        const previewDiv = document.getElementById(`${evrakTuru}-preview`);

        if (files.length === 0) {
          statusDiv.textContent = '';
          previewDiv.innerHTML = '';
          return;
        }

        // Dosya boyut kontrolü (5MB max)
        const maxSize = 5 * 1024 * 1024; // 5MB
        let hasOversizeFile = false;

        files.forEach((file) => {
          if (file.size > maxSize) {
            hasOversizeFile = true;
          }
        });

        if (hasOversizeFile) {
          alert(
            '⚠️ Dosya boyutu çok büyük! Maksimum 5MB dosya yükleyebilirsiniz.'
          );
          fileInput.value = '';
          statusDiv.textContent = '';
          previewDiv.innerHTML = '';
          return;
        }

        // Başarılı yükleme durumu
        if (evrakTuru === 'digerEvraklar') {
          statusDiv.innerHTML = `<span style="color: #059669;">✅ ${files.length} dosya seçildi</span>`;
          let previewHTML = '';
          files.forEach((file, index) => {
            previewHTML += `<div style="background: #f0fdf4; padding: 5px; margin: 2px 0; border-radius: 4px; font-size: 11px;">
              📄 ${file.name} (${(file.size / 1024).toFixed(1)}KB)
            </div>`;
          });
          previewDiv.innerHTML = previewHTML;
        } else {
          const file = files[0];
          statusDiv.innerHTML = `<span style="color: #059669;">✅ ${file.name} seçildi</span>`;
          previewDiv.textContent = `📄 ${file.name} (${(file.size / 1024).toFixed(1)}KB)`;
        }

        // Geçici dosya verilerini saklama (Demo için - gerçek uygulamada sunucuya gönderilir)
        const tempFileData = {
          evrakTuru: evrakTuru,
          files: files.map((file) => ({
            name: file.name,
            size: file.size,
            type: file.type,
            lastModified: file.lastModified,
            dataUrl: null, // Gerçek uygulamada base64 veya sunucu URL'i
          })),
          yuklenmeTarihi: new Date().toISOString(),
          yukleyenFirma: isAdmin
            ? 'Sistem Yöneticisi'
            : firmaConfig[currentFirma].name,
        };

        // Global geçici evrak deposunda sakla
        if (!window.tempEvraklar) window.tempEvraklar = {};
        window.tempEvraklar[evrakTuru] = tempFileData;

        console.log('Evrak yüklendi:', tempFileData);
      }

      function evrakValidasyonu() {
        // Zorunlu evrakları kontrol et
        const zorunluEvraklar = ['kimlikBelgesi', 'adliSicilKaydi'];
        const eksikEvraklar = [];

        zorunluEvraklar.forEach((evrak) => {
          const input = document.getElementById(evrak);
          if (!input.files || input.files.length === 0) {
            eksikEvraklar.push(evrakTurleri[evrak].name);
          }
        });

        if (eksikEvraklar.length > 0) {
          alert(
            `⚠️ Eksik Belgeler:\n\n${eksikEvraklar.map((e) => '• ' + e).join('\n')}\n\nLütfen zorunlu belgeleri yükleyiniz.`
          );
          return false;
        }

        return true;
      }

      function savePersonelEvraklari(personelId) {
        if (!window.tempEvraklar) return;

        // Personelin evraklarını kaydet
        if (!personelEvraklari[personelId]) {
          personelEvraklari[personelId] = {};
        }

        Object.keys(window.tempEvraklar).forEach((evrakTuru) => {
          personelEvraklari[personelId][evrakTuru] =
            window.tempEvraklar[evrakTuru];
        });

        // Activity log ekle
        const evrakSayisi = Object.keys(window.tempEvraklar).reduce(
          (sum, key) => {
            return sum + window.tempEvraklar[key].files.length;
          },
          0
        );

        addActivityLog(
          `${evrakSayisi} evrak yüklendi (Personel: ${personelId})`
        );

        // Geçici verileri temizle
        window.tempEvraklar = {};

        console.log(
          'Personel evrakları kaydedildi:',
          personelEvraklari[personelId]
        );
      }

      // WhatsApp ve Gmail paylaşım fonksiyonları
      function paylaşWhatsApp(mesaj, telefon = '') {
        const formattedPhone = telefon.replace(/[^0-9]/g, '');
        const encodedMessage = encodeURIComponent(mesaj);
        const whatsappUrl = `https://wa.me/${formattedPhone}?text=${encodedMessage}`;
        window.open(whatsappUrl, '_blank');

        addActivityLog(`WhatsApp üzerinden paylaştırıldı: ${telefon}`);
      }

      function paylaşGmail(
        mesaj,
        email = '',
        konu = 'HC Sigorta - Personel Evrakları'
      ) {
        const encodedSubject = encodeURIComponent(konu);
        const encodedBody = encodeURIComponent(mesaj);
        const gmailUrl = `https://mail.google.com/mail/?view=cm&to=${email}&su=${encodedSubject}&body=${encodedBody}`;
        window.open(gmailUrl, '_blank');

        addActivityLog(`Gmail üzerinden paylaştırıldı: ${email}`);
      }

      function indirPersonelEvraklari(personelId, evrakTuru = null) {
        const evraklar = personelEvraklari[personelId];
        if (!evraklar) {
          alert('Bu personele ait evrak bulunamadı.');
          return;
        }

        if (evrakTuru && evraklar[evrakTuru]) {
          // Tek evrak tipi indir
          const evrak = evraklar[evrakTuru];
          alert(
            `📥 İndiriliyor: ${evrakTurleri[evrakTuru].name}\n\n${evrak.files.length} dosya\nYükleme Tarihi: ${new Date(evrak.yuklenmeTarihi).toLocaleString('tr-TR')}\nYükleyen: ${evrak.yukleyenFirma}\n\nEvrak dosyaları indiriliyor...`
          );
          addActivityLog(
            `Evrak indirildi: ${evrakTurleri[evrakTuru].name} (${personelId})`
          );
        } else {
          // Tüm evrakları indir
          const toplamDosya = Object.values(evraklar).reduce(
            (sum, evrak) => sum + evrak.files.length,
            0
          );
          alert(
            `📥 Tüm Evraklar İndiriliyor:\n\n${toplamDosya} dosya\nPersonel: ${personelId}\n\nEvrak Türleri:\n${Object.keys(
              evraklar
            )
              .map(
                (tur) =>
                  `• ${evrakTurleri[tur].name}: ${evraklar[tur].files.length} dosya`
              )
              .join(
                '\n'
              )}\n\nTüm evraklar ZIP dosyası olarak indiriliyor...`
          );
          addActivityLog(`Tüm evraklar indirildi (${personelId})`);
        }
      }

      // Uygulama başlatma
      function initializeApp() {
        createTabs();
        if (isAdmin) {
          showTab('ana-sayfa');
        } else {
          showTab(currentFirma);
        }
      }

      // Sekmeleri oluştur
      function createTabs() {
        const tabButtons = document.getElementById('tabButtons');
        let buttonsHTML = '';

        if (isAdmin) {
          // Admin için tüm sekmeler
          buttonsHTML += `
                    <button class="tab-button active" data-firma="ana-sayfa" onclick="showTab('ana-sayfa')">
                        📊 ANA SAYFA<br>TOPLAM
                    </button>
                    <button class="tab-button" data-firma="tum-personel" onclick="showTab('tum-personel')">
                        👥 TÜM PERSONEL<br>FİRMA BAZLI
                    </button>
                `;

          Object.keys(firmaConfig).forEach((firmaKey) => {
            buttonsHTML += `
                        <button class="tab-button" data-firma="${firmaKey}" onclick="showTab('${firmaKey}')">
                            ${firmaConfig[firmaKey].name}
                        </button>
                    `;
          });

          buttonsHTML += `
                    <button class="tab-button" data-firma="yonetim-paneli" onclick="showTab('yonetim-paneli')">
                        ⚙️ YÖNETİM PANELİ<br>KULLANICI & İŞLETME
                    </button>
                    <button class="tab-button" data-firma="yeni-personel" onclick="showTab('yeni-personel')">
                        ➕ YENİ PERSONEL
                    </button>
                `;
        } else {
          // Sadece kendi firması
          buttonsHTML += `
                    <button class="tab-button active" data-firma="${currentFirma}" onclick="showTab('${currentFirma}')">
                        ${firmaConfig[currentFirma].name}
                    </button>
                    <button class="tab-button" data-firma="kullanici-ayarlari" onclick="showTab('kullanici-ayarlari')">
                        👤 KULLANICI AYARLARI<br>ŞİFRE & YETKİ
                    </button>
                    <button class="tab-button" data-firma="yeni-personel" onclick="showTab('yeni-personel')">
                        ➕ YENİ PERSONEL
                    </button>
                `;
        }

        tabButtons.innerHTML = buttonsHTML;
      }

      // Sekme değiştirme
      function showTab(tabName) {
        const tabPanes = document.querySelectorAll('.tab-pane');
        tabPanes.forEach((pane) => pane.remove());

        const tabButtons = document.querySelectorAll('.tab-button');
        tabButtons.forEach((button) => button.classList.remove('active'));

        const activeButton = document.querySelector(
          `[data-firma="${tabName}"]`
        );
        if (activeButton) activeButton.classList.add('active');

        const tabContent = document.getElementById('tabContent');

        if (tabName === 'ana-sayfa') {
          tabContent.innerHTML = createAnaSayfaContent();
          updateAnaSayfa();
        } else if (tabName === 'tum-personel') {
          tabContent.innerHTML = createTumPersonelContent();
          loadTumPersonelTable();
        } else if (tabName === 'yonetim-paneli') {
          tabContent.innerHTML = createYonetimPaneliContent();
          loadYonetimPaneli();
        } else if (tabName === 'kullanici-ayarlari') {
          tabContent.innerHTML = createKullaniciAyarlariContent();
          loadKullaniciAyarlari();
        } else if (tabName === 'yeni-personel') {
          tabContent.innerHTML = createYeniPersonelContent();
        } else {
          tabContent.innerHTML = createFirmaContent(tabName);
          loadFirmaTable(tabName);
        }
      }

      // Ana sayfa içeriği
      function createAnaSayfaContent() {
        return `
                <div class="tab-pane active">
                    <h2 class="section-title">📊 GENEL ÖZET - TÜM FİRMALAR</h2>
                    
                    <!-- Asgari Ücret Ayarları (Sadece Admin Görebilir) -->
                    <div class="asgari-ucret-panel" style="background: linear-gradient(135deg, #f0f9ff, #e0f2fe); padding: 20px; border-radius: 10px; margin-bottom: 20px; border: 2px solid #0ea5e9;">
                        <h3 style="color: #0c4a6e; margin-bottom: 15px;">⚙️ ASGARİ ÜCRET AYARLARI (2024)</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; font-weight: bold; color: #0c4a6e; margin-bottom: 5px;">💰 Brüt Asgari Ücret</label>
                                <input type="number" id="brutAsgariUcret" value="17002.12" step="0.01" 
                                       style="width: 100%; padding: 10px; border: 2px solid #0ea5e9; border-radius: 5px; font-size: 14px;"
                                       onchange="updateAsgariUcret()">
                            </div>
                            <div>
                                <label style="display: block; font-weight: bold; color: #0c4a6e; margin-bottom: 5px;">💵 Net Asgari Ücret</label>
                                <input type="number" id="netAsgariUcret" value="13414.58" step="0.01"
                                       style="width: 100%; padding: 10px; border: 2px solid #0ea5e9; border-radius: 5px; font-size: 14px;"
                                       onchange="updateAsgariUcret()">
                            </div>
                            <div>
                                <label style="display: block; font-weight: bold; color: #0c4a6e; margin-bottom: 5px;">🏢 İşveren Maliyet Farkı</label>
                                <input type="number" id="muafiyetMiktari" value="3587.54" step="0.01" readonly
                                       style="width: 100%; padding: 10px; border: 2px solid #94a3b8; border-radius: 5px; font-size: 14px; background: #f1f5f9; color: #475569;">
                            </div>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <small style="color: #475569;">📅 Son Güncelleme: <span id="asgariUcretGuncelleme">${asgariUcretConfig.guncellemeZamani}</span></small>
                            <button onclick="kaydetAsgariUcret()" style="background: #059669; color: white; padding: 8px 15px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold;">💾 Kaydet</button>
                        </div>
                    </div>

                    <!-- PDF ve Yazdırma Butonları -->
                    <div style="display: flex; gap: 10px; margin-bottom: 20px; justify-content: flex-end;">
                        <button onclick="yazdir()" style="background: #2563eb; color: white; padding: 10px 15px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;">🖨️ Yazdır</button>
                        <button onclick="pdfKaydet()" style="background: #dc2626; color: white; padding: 10px 15px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;">📄 PDF Kaydet</button>
                        <button onclick="excelKaydet()" style="background: #059669; color: white; padding: 10px 15px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;">📊 Excel Kaydet</button>
                    </div>
                    
                    <!-- Genel İstatistikler -->
                    <div class="stat-cards">
                        <div class="stat-card">
                            <h4 id="toplamPersonel">0</h4>
                            <p>Toplam Personel</p>
                                </div>
                        <div class="stat-card">
                            <h4 id="toplamNetMaas">₺0</h4>
                            <p>Toplam Net Maaş</p>
                                </div>
                        <div class="stat-card">
                            <h4 id="toplamIsverenMaliyet">₺0</h4>
                            <p>Toplam İşveren Maliyeti</p>
                            </div>
                        <div class="stat-card">
                            <h4 id="aktifFirma">0</h4>
                            <p>Aktif Firma Sayısı</p>
                            </div>
                        </div>
                        
                    <!-- Firma Özetleri -->
                    <div class="ana-sayfa-ozet" id="firmaOzetleri">
                        <!-- Firma özetleri JavaScript ile doldurulacak -->
                    </div>
                    
                    <!-- Toplam Tablo -->
                    <div class="toplam-tablo">
                        <h3>🏢 FİRMALARA GÖRE DETAYLI ÖZET</h3>
                        <table class="personel-table">
                            <thead>
                                <tr>
                                    <th>Şirket Adı</th>
                                    <th>Personel Sayısı</th>
                                    <th>Toplam Brüt Maaş</th>
                                    <th>Toplam Net Maaş</th>
                                    <th>Toplam İşçi Kesinti</th>
                                    <th>Toplam İşveren Maliyet</th>
                                    <th>Ortalama Maaş</th>
                                </tr>
                            </thead>
                            <tbody id="toplamTabloBody">
                                <!-- Toplam veriler JavaScript ile doldurulacak -->
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
      }

      // Firma içeriği
      function createFirmaContent(firmaKey) {
        const firma = firmaConfig[firmaKey];
        return `
                <div class="tab-pane active">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2 class="section-title" style="color: ${firma.color}; margin-bottom: 0;">${firma.name} - Personel Listesi</h2>
                        <div style="display: flex; gap: 8px;">
                            <button onclick="yazdir()" style="background: #2563eb; color: white; padding: 8px 12px; border: none; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: bold;">🖨️ Yazdır</button>
                            <button onclick="pdfKaydet()" style="background: #dc2626; color: white; padding: 8px 12px; border: none; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: bold;">📄 PDF</button>
                            <button onclick="excelKaydet()" style="background: #059669; color: white; padding: 8px 12px; border: none; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: bold;">📊 Excel</button>
                        </div>
                    </div>
                    <div class="firma-${firmaKey}" style="padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <strong>${firma.name} Personeli</strong>
                    </div>
                    <table class="personel-table">
                        <thead>
                            <tr>
                                <th style="width: 140px;">Ad Soyad</th>
                                <th style="width: 110px;">Pozisyon</th>
                                <th style="width: 80px;">Brüt Maaş (₺)</th>
                                <th style="width: 60px;">Çalışılan Gün</th>
                                <th style="width: 80px;">Günlük Tutar</th>
                                <th style="width: 90px;">Net Maaş (₺)</th>
                                <th style="width: 90px;">Gelir Vergisi</th>
                                <th style="width: 90px;">İşçi SSK</th>
                                <th style="width: 90px;">Damga Vergisi</th>
                                <th style="width: 70px;">Muhasebe</th>
                                <th style="width: 110px;">İşçi Toplam Kesinti</th>
                                <th style="width: 110px;">İşveren SSK</th>
                                <th style="width: 120px;">İşveren Toplam Maliyet</th>
                                <th style="width: 70px;">Detay</th>
                            </tr>
                        </thead>
                        <tbody id="${firmaKey}-body">
                            <!-- Bu firma personelleri JavaScript ile doldurulacak -->
                        </tbody>
                    </table>
                </div>
            `;
      }

      // Yeni personel içeriği
      function createYeniPersonelContent() {
        let firmaOptions = '';
        if (isAdmin) {
          Object.keys(firmaConfig).forEach((firmaKey) => {
            firmaOptions += `<option value="${firmaKey}">${firmaConfig[firmaKey].name}</option>`;
          });
        } else {
          firmaOptions = `<option value="${currentFirma}">${firmaConfig[currentFirma].name}</option>`;
        }

        return `
                <div class="tab-pane active">
                    <div class="yeni-personel-form">
                        <h2 class="section-title">➕ Yeni Personel Ekle</h2>
                        
                        <form id="personelForm">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="firmaSecim">Şirket Seçimi *</label>
                                    <select id="firmaSecim" name="firma" required ${!isAdmin ? 'disabled' : ''}>
                                        <option value="">Şirket Seçin</option>
                                        ${firmaOptions}
                                    </select>
                                    </div>
                                <div class="form-group">
                                    <label for="isim">Ad Soyad *</label>
                                    <input type="text" id="isim" name="isim" required>
                                    </div>
                                </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="pozisyon">Pozisyon/İş Tanımı</label>
                                    <input type="text" id="pozisyon" name="pozisyon">
                                </div>
                                <div class="form-group">
                                    <label for="brutMaas">Brüt Maaş (₺)</label>
                                    <input type="number" id="brutMaas" name="brutMaas" placeholder="17002" min="17002" onchange="maasInputChange()">
                                    <div style="margin-top: 10px;">
                                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; background: linear-gradient(135deg, #fef3c7, #fbbf24); padding: 8px; border-radius: 5px; font-size: 12px;">
                                            <input type="checkbox" id="asgariUcretCheck" onchange="asgariUcretToggle()" style="transform: scale(1.2);">
                                            <span style="font-weight: bold; color: #92400e;">💰 Asgari Ücret (Muafiyetli)</span>
                                        </label>
                                        <small style="color: #6b7280; margin-left: 20px;">Net: ₺${asgariUcretConfig.netAsgariUcret} - Brüt: ₺${asgariUcretConfig.brutAsgariUcret}</small>
                                    </div>
                            </div>
                        </div>
                        
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="telefon">Telefon</label>
                                    <input type="tel" id="telefon" name="telefon">
                                </div>
                                <div class="form-group">
                                    <label for="email">E-mail</label>
                                    <input type="email" id="email" name="email">
                        </div>
                    </div>

                    <!-- Evrak ve Belgeler Bölümü -->
                    <div class="evrak-section" style="margin-top: 25px; padding: 20px; background: linear-gradient(135deg, #f8fafc, #e2e8f0); border-radius: 10px; border: 2px solid #cbd5e1;">
                        <h3 style="color: #1e293b; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                            📎 Evrak ve Belgeler
                            <small style="color: #64748b; font-weight: normal;">(PDF, JPG, PNG formatları desteklenir)</small>
                        </h3>
                        
                        <div class="evrak-upload-section" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div class="evrak-group">
                                <label style="display: block; font-weight: bold; color: #374151; margin-bottom: 8px;">
                                    🆔 Kimlik Belgesi *
                                </label>
                                <div class="file-upload-container" style="position: relative;">
                                    <input type="file" id="kimlikBelgesi" name="kimlikBelgesi" 
                                           accept=".pdf,.jpg,.jpeg,.png" 
                                           style="display: none;" 
                                           onchange="handleFileUpload('kimlikBelgesi', this)">
                                    <button type="button" onclick="document.getElementById('kimlikBelgesi').click()" 
                                            style="width: 100%; padding: 10px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer;">
                                        📁 Dosya Seç
                                    </button>
                                    <div id="kimlikBelgesi-status" style="margin-top: 5px; font-size: 12px; color: #6b7280;"></div>
                                </div>
                                <small id="kimlikBelgesi-preview" style="display: block; color: #059669; font-weight: bold; margin-top: 5px;"></small>
                            </div>

                            <div class="evrak-group">
                                <label style="display: block; font-weight: bold; color: #374151; margin-bottom: 8px;">
                                    🎓 Diploma/Mezuniyet Belgesi
                                </label>
                                <div class="file-upload-container" style="position: relative;">
                                    <input type="file" id="diplomaBelgesi" name="diplomaBelgesi" 
                                           accept=".pdf,.jpg,.jpeg,.png" 
                                           style="display: none;" 
                                           onchange="handleFileUpload('diplomaBelgesi', this)">
                                    <button type="button" onclick="document.getElementById('diplomaBelgesi').click()" 
                                            style="width: 100%; padding: 10px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer;">
                                        📁 Dosya Seç
                                    </button>
                                    <div id="diplomaBelgesi-status" style="margin-top: 5px; font-size: 12px; color: #6b7280;"></div>
                                </div>
                                <small id="diplomaBelgesi-preview" style="display: block; color: #059669; font-weight: bold; margin-top: 5px;"></small>
                            </div>

                            <div class="evrak-group">
                                <label style="display: block; font-weight: bold; color: #374151; margin-bottom: 8px;">
                                    📋 Adli Sicil Kaydı *
                                </label>
                                <div class="file-upload-container" style="position: relative;">
                                    <input type="file" id="adliSicilKaydi" name="adliSicilKaydi" 
                                           accept=".pdf,.jpg,.jpeg,.png" 
                                           style="display: none;" 
                                           onchange="handleFileUpload('adliSicilKaydi', this)">
                                    <button type="button" onclick="document.getElementById('adliSicilKaydi').click()" 
                                            style="width: 100%; padding: 10px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer;">
                                        📁 Dosya Seç
                                    </button>
                                    <div id="adliSicilKaydi-status" style="margin-top: 5px; font-size: 12px; color: #6b7280;"></div>
                                </div>
                                <small id="adliSicilKaydi-preview" style="display: block; color: #059669; font-weight: bold; margin-top: 5px;"></small>
                            </div>

                            <div class="evrak-group">
                                <label style="display: block; font-weight: bold; color: #374151; margin-bottom: 8px;">
                                    🏥 Sağlık Raporu
                                </label>
                                <div class="file-upload-container" style="position: relative;">
                                    <input type="file" id="saglikRaporu" name="saglikRaporu" 
                                           accept=".pdf,.jpg,.jpeg,.png" 
                                           style="display: none;" 
                                           onchange="handleFileUpload('saglikRaporu', this)">
                                    <button type="button" onclick="document.getElementById('saglikRaporu').click()" 
                                            style="width: 100%; padding: 10px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer;">
                                        📁 Dosya Seç
                                    </button>
                                    <div id="saglikRaporu-status" style="margin-top: 5px; font-size: 12px; color: #6b7280;"></div>
                                </div>
                                <small id="saglikRaporu-preview" style="display: block; color: #059669; font-weight: bold; margin-top: 5px;"></small>
                            </div>
                        </div>

                        <!-- Diğer Evraklar -->
                        <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #e2e8f0;">
                            <label style="display: block; font-weight: bold; color: #374151; margin-bottom: 8px;">
                                📄 Diğer Evraklar (CV, Sertifikalar, Referanslar)
                            </label>
                            <div class="file-upload-container" style="position: relative;">
                                <input type="file" id="digerEvraklar" name="digerEvraklar" 
                                       accept=".pdf,.jpg,.jpeg,.png,.doc,.docx" 
                                       multiple
                                       style="display: none;" 
                                       onchange="handleFileUpload('digerEvraklar', this)">
                                <button type="button" onclick="document.getElementById('digerEvraklar').click()" 
                                        style="width: 100%; padding: 10px; background: #059669; color: white; border: none; border-radius: 6px; cursor: pointer;">
                                    📁 Çoklu Dosya Seç (Birden fazla dosya seçebilirsiniz)
                                </button>
                                <div id="digerEvraklar-status" style="margin-top: 5px; font-size: 12px; color: #6b7280;"></div>
                            </div>
                            <div id="digerEvraklar-preview" style="margin-top: 8px;"></div>
                        </div>
                        
                        <div style="margin-top: 15px; padding: 10px; background: #fef3c7; border-radius: 6px; border-left: 4px solid #f59e0b;">
                            <small style="color: #92400e;">
                                <strong>📝 Not:</strong> Zorunlu belgeler (*) işaretli olanlar personel eklemek için gereklidir.
                                Evraklar sistem yöneticisi tarafından görüntülenebilir ve indirilebilir.
                            </small>
                        </div>
                    </div>

                            <div class="form-group">
                                <label for="adres">Adres</label>
                                <textarea id="adres" name="adres" rows="3"></textarea>
                            </div>

                            <button type="submit" class="btn">Personel Ekle</button>
                        </form>
                        </div>
                    </div>
                `;
      }

      // Tüm Personel içeriği - Firma rengine göre
      function createTumPersonelContent() {
        return `
                <div class="tab-pane active">
                    <h2 class="section-title">👥 TÜM PERSONEL LİSTESİ - FİRMA BAZLI</h2>
                    
                    <!-- Genel İstatistikler -->
                    <div class="stat-cards">
                        <div class="stat-card">
                            <h4 id="tumPersonelSayisi">0</h4>
                            <p>Toplam Personel Sayısı</p>
                        </div>
                        <div class="stat-card">
                            <h4 id="aktifFirmaSayisi">0</h4>
                            <p>Aktif Firma Sayısı</p>
                        </div>
                        <div class="stat-card">
                            <h4 id="toplamMaasBordrosu">₺0</h4>
                            <p>Toplam Net Maaş</p>
                        </div>
                        <div class="stat-card">
                            <h4 id="toplamMaliyet">₺0</h4>
                            <p>Toplam İşveren Maliyeti</p>
                        </div>
                    </div>

                    <!-- Tüm Personel Tablosu -->
                    <div style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);">
                        <table class="personel-table">
                            <thead>
                                <tr>
                                    <th style="width: 120px;">Firma</th>
                                    <th style="width: 140px;">Ad Soyad</th>
                                    <th style="width: 110px;">Pozisyon</th>
                                    <th style="width: 80px;">Brüt Maaş (₺)</th>
                                    <th style="width: 60px;">Çalışılan Gün</th>
                                    <th style="width: 90px;">Net Maaş (₺)</th>
                                    <th style="width: 90px;">Gelir Vergisi</th>
                                    <th style="width: 90px;">İşçi SSK</th>
                                    <th style="width: 90px;">Damga Vergisi</th>
                                    <th style="width: 110px;">İşveren SSK</th>
                                    <th style="width: 120px;">İşveren Maliyeti</th>
                                    <th style="width: 70px;">İşlemler</th>
                                </tr>
                            </thead>
                            <tbody id="tumPersonelBody">
                                <!-- Tüm personel JavaScript ile doldurulacak -->
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
      }

      // Yönetim Paneli içeriği
      function createYonetimPaneliContent() {
        return `
                <div class="tab-pane active">
                    <h2 class="section-title">⚙️ SİSTEM YÖNETİM PANELİ</h2>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;">
                        <!-- Kullanıcı Yönetimi -->
                        <div style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);">
                            <h3 style="color: #667eea; margin-bottom: 20px;">
                                <i style="margin-right: 8px;">👥</i>Kullanıcı Yönetimi
                            </h3>
                            
                            <div style="margin-bottom: 20px;">
                                <button class="btn" onclick="showUserAddForm()" style="background: linear-gradient(135deg, #10b981, #34d399);">
                                    ➕ Yeni Kullanıcı Ekle
                                </button>
                                <button class="btn" onclick="refreshUserList()" style="background: linear-gradient(135deg, #3b82f6, #60a5fa); margin-left: 10px;">
                                    🔄 Kullanıcıları Yenile
                                </button>
                            </div>

                            <div id="userManagementArea">
                                <!-- Kullanıcı listesi buraya yüklenecek -->
                            </div>
                        </div>

                        <!-- İşletme Yönetimi -->
                        <div style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);">
                            <h3 style="color: #ef4444; margin-bottom: 20px;">
                                <i style="margin-right: 8px;">🏢</i>İşletme Yönetimi
                            </h3>
                            
                            <div style="margin-bottom: 20px;">
                                <button class="btn" onclick="showFirmaAddForm()" style="background: linear-gradient(135deg, #10b981, #34d399);">
                                    ➕ Yeni İşletme Ekle
                                </button>
                                <button class="btn" onclick="exportAllData()" style="background: linear-gradient(135deg, #f59e0b, #fbbf24); margin-left: 10px;">
                                    📥 Tümünü Dışa Aktar
                                </button>
                            </div>

                            <div id="firmaManagementArea">
                                <!-- Firma yönetimi buraya yüklenecek -->
                            </div>
                        </div>
                    </div>

                    <!-- Evrak Yönetimi -->
                    <div style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); margin-bottom: 30px;">
                        <h3 style="color: #059669; margin-bottom: 20px;">
                            <i style="margin-right: 8px;">📎</i>Evrak Yönetimi
                        </h3>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                            <div style="text-align: center; padding: 15px; background: #f0fdf4; border-radius: 8px;">
                                <div style="font-size: 24px; font-weight: bold; color: #059669;" id="toplamPersonelEvrak">0</div>
                                <div style="color: #065f46; font-size: 12px;">Evraklı Personel</div>
                            </div>
                            <div style="text-align: center; padding: 15px; background: #eff6ff; border-radius: 8px;">
                                <div style="font-size: 24px; font-weight: bold; color: #2563eb;" id="toplamEvrakSayisi">0</div>
                                <div style="color: #1d4ed8; font-size: 12px;">Toplam Evrak</div>
                            </div>
                            <div style="text-align: center; padding: 15px; background: #fef3c7; border-radius: 8px;">
                                <div style="font-size: 24px; font-weight: bold; color: #d97706;" id="eksikEvrakSayisi">0</div>
                                <div style="color: #92400e; font-size: 12px;">Eksik Belgeli</div>
                            </div>
                        </div>

                        <div style="display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap;">
                            <button class="btn" onclick="loadEvrakYonetimi()" style="background: linear-gradient(135deg, #059669, #10b981);">
                                🔄 Evrakları Yenile
                            </button>
                            <button class="btn" onclick="exportAllEvraklar()" style="background: linear-gradient(135deg, #dc2626, #ef4444);">
                                📥 Tüm Evrakları İndir
                            </button>
                            <button class="btn" onclick="evrakIstatistikleri()" style="background: linear-gradient(135deg, #7c3aed, #8b5cf6);">
                                📊 Evrak Raporu
                            </button>
                        </div>

                        <div id="evrakYonetimArea">
                            <!-- Evrak yönetimi buraya yüklenecek -->
                        </div>
                    </div>

                    <!-- Activity Log -->
                    <div style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);">
                        <h3 style="color: #8b5cf6; margin-bottom: 20px;">
                            <i style="margin-right: 8px;">📋</i>Sistem Aktivite Geçmişi
                        </h3>
                        <div id="activityLogArea" style="max-height: 400px; overflow-y: auto;">
                            <!-- Activity log buraya yüklenecek -->
                        </div>
                    </div>
                </div>
            `;
      }

      // Kullanıcı Ayarları içeriği (Normal kullanıcılar için)
      function createKullaniciAyarlariContent() {
        return `
                <div class="tab-pane active">
                    <h2 class="section-title">👤 KULLANICI AYARLARI - ${firmaConfig[currentFirma].name}</h2>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;">
                        <!-- Şifre Değiştirme -->
                        <div style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);">
                            <h3 style="color: #ef4444; margin-bottom: 20px;">
                                <i style="margin-right: 8px;">🔐</i>Şifre Değiştirme
                            </h3>
                            
                            <form id="passwordChangeForm">
                                <div style="margin-bottom: 15px;">
                                    <label style="display: block; margin-bottom: 5px; font-weight: 600;">Mevcut Şifre:</label>
                                    <input type="password" id="currentPassword" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px;" required>
                                </div>
                                <div style="margin-bottom: 15px;">
                                    <label style="display: block; margin-bottom: 5px; font-weight: 600;">Yeni Şifre:</label>
                                    <input type="password" id="newPassword" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px;" required>
                                </div>
                                <div style="margin-bottom: 20px;">
                                    <label style="display: block; margin-bottom: 5px; font-weight: 600;">Yeni Şifre (Tekrar):</label>
                                    <input type="password" id="confirmPassword" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px;" required>
                                </div>
                                <button type="submit" class="btn" style="background: linear-gradient(135deg, #ef4444, #f87171);">🔒 Şifreyi Değiştir</button>
                            </form>
                        </div>

                        <!-- Kullanıcı Bilgileri -->
                        <div style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);">
                            <h3 style="color: #3b82f6; margin-bottom: 20px;">
                                <i style="margin-right: 8px;">ℹ️</i>Kullanıcı Bilgileri
                            </h3>
                            
                            <div id="userInfoArea">
                                <!-- Kullanıcı bilgileri buraya yüklenecek -->
                            </div>

                            <h4 style="color: #10b981; margin: 20px 0 15px 0;">
                                <i style="margin-right: 8px;">👥</i>Firma Kullanıcıları
                            </h4>
                            
                            <div style="margin-bottom: 15px;">
                                <button class="btn" onclick="showAddUserForm()" style="background: linear-gradient(135deg, #10b981, #34d399);">
                                    ➕ Yeni Kullanıcı Ekle
                                </button>
                            </div>

                            <div id="firmUserListArea">
                                <!-- Firma kullanıcıları buraya yüklenecek -->
                            </div>
                        </div>
                    </div>

                    <!-- Aktivite Geçmişi (Bu kullanıcı için) -->
                    <div style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);">
                        <h3 style="color: #8b5cf6; margin-bottom: 20px;">
                            <i style="margin-right: 8px;">📋</i>Aktivite Geçmişiniz
                        </h3>
                        <div id="userActivityLogArea" style="max-height: 300px; overflow-y: auto;">
                            <!-- Kullanıcı aktivite geçmişi buraya yüklenecek -->
                        </div>
                        </div>
                    </div>
                `;
      }

      // Ana sayfa güncelleme
      function updateAnaSayfa() {
        let toplamPersonel = 0;
        let toplamNetMaas = 0;
        let toplamIsverenMaliyet = 0;
        let aktifFirma = 0;

        const firmaRenkleri = {
          'hc-klinik': 'firma-hc-klinik',
          'hc-lab': 'firma-hc-lab',
          'hc-eczane': 'firma-hc-eczane',
          'hc-dental': 'firma-hc-dental',
          'hc-goz': 'firma-hc-goz',
          'hc-fizyo': 'firma-hc-fizyo',
          'hc-diyetisyen': 'firma-hc-diyetisyen',
          'hc-radyoloji': 'firma-hc-radyoloji',
          'hc-ambulans': 'firma-hc-ambulans',
          'hc-temizlik': 'firma-hc-temizlik',
        };

        const firmaOzetleriHTML = [];
        const toplamTabloHTML = [];

        Object.keys(firmaPersonelleri).forEach((firmaKey) => {
          const personeller = firmaPersonelleri[firmaKey];
          if (personeller.length > 0) {
            aktifFirma++;
            let firmaToplam = {
              personel: 0,
              netMaas: 0,
              isverenMaliyet: 0,
              brutMaas: 0,
              isciKesinti: 0,
            };

            personeller.forEach((personel) => {
              const hesap = hesaplaMaas(
                personel.brutMaas,
                personel.calistigiGun
              );
              firmaToplam.personel++;
              firmaToplam.netMaas += hesap.netMaas;
              firmaToplam.isverenMaliyet += hesap.toplamIsverenMaliyet;
              firmaToplam.brutMaas += hesap.oranliMaas;
              firmaToplam.isciKesinti += hesap.toplamIsciKesinti;
            });

            toplamPersonel += firmaToplam.personel;
            toplamNetMaas += firmaToplam.netMaas;
            toplamIsverenMaliyet += firmaToplam.isverenMaliyet;

            // Firma özet kartı
            firmaOzetleriHTML.push(`
                        <div class="firma-ozet-kart ${firmaRenkleri[firmaKey]}">
                            <h3>${firmaConfig[firmaKey].name}</h3>
                            <div class="ozet-bilgi">
                                <div><strong>Personel:</strong> ${firmaToplam.personel} kişi</div>
                                <div><strong>Net Maaş:</strong> ₺${firmaToplam.netMaas.toFixed(0)}</div>
                                <div><strong>Brüt Maaş:</strong> ₺${firmaToplam.brutMaas.toFixed(0)}</div>
                                <div><strong>İşveren Maliyet:</strong> ₺${firmaToplam.isverenMaliyet.toFixed(0)}</div>
                                        </div>
                </div>
                    `);

            // Toplam tablo satırı
            toplamTabloHTML.push(`
                        <tr class="${firmaRenkleri[firmaKey].replace('firma-', '')}" style="border-left: 5px solid ${firmaConfig[firmaKey].color};">
                            <td><strong>${firmaConfig[firmaKey].name}</strong></td>
                            <td class="hesaplanan">${firmaToplam.personel}</td>
                            <td class="pozitif">₺${firmaToplam.brutMaas.toFixed(0)}</td>
                            <td class="pozitif"><strong>₺${firmaToplam.netMaas.toFixed(0)}</strong></td>
                            <td class="negatif">₺${firmaToplam.isciKesinti.toFixed(0)}</td>
                            <td class="negatif">₺${firmaToplam.isverenMaliyet.toFixed(0)}</td>
                            <td class="hesaplanan">₺${(firmaToplam.netMaas / firmaToplam.personel).toFixed(0)}</td>
                        </tr>
                    `);
          }
        });

        // İstatistikleri güncelle
        const toplamPersonelEl = document.getElementById('toplamPersonel');
        const toplamNetMaasEl = document.getElementById('toplamNetMaas');
        const toplamIsverenMaliyetEl = document.getElementById(
          'toplamIsverenMaliyet'
        );
        const aktifFirmaEl = document.getElementById('aktifFirma');

        if (toplamPersonelEl) toplamPersonelEl.textContent = toplamPersonel;
        if (toplamNetMaasEl)
          toplamNetMaasEl.textContent = `₺${toplamNetMaas.toFixed(0)}`;
        if (toplamIsverenMaliyetEl)
          toplamIsverenMaliyetEl.textContent = `₺${toplamIsverenMaliyet.toFixed(0)}`;
        if (aktifFirmaEl) aktifFirmaEl.textContent = aktifFirma;

        // Firma özetlerini ve toplam tabloyu güncelle
        const firmaOzetleriEl = document.getElementById('firmaOzetleri');
        const toplamTabloBodyEl = document.getElementById('toplamTabloBody');

        if (firmaOzetleriEl)
          firmaOzetleriEl.innerHTML = firmaOzetleriHTML.join('');
        if (toplamTabloBodyEl)
          toplamTabloBodyEl.innerHTML = toplamTabloHTML.join('');
      }

      // Firma tablosunu yükle
      function loadFirmaTable(firmaKey) {
        const tbody = document.getElementById(`${firmaKey}-body`);
        if (!tbody) return;

        const personeller = firmaPersonelleri[firmaKey] || [];
        tbody.innerHTML = '';

        personeller.forEach((personel, index) => {
          const hesap = hesaplaMaas(
            personel.brutMaas,
            personel.calistigiGun,
            personel.isAsgariUcret
          );
          const row = document.createElement('tr');
          const asgariUcretStyle = personel.isAsgariUcret
            ? 'background: linear-gradient(135deg, #fef3c7, #fbbf24); color: #92400e; font-weight: bold;'
            : '';
          const asgariUcretBadge = personel.isAsgariUcret ? '💰 ' : '';

          row.innerHTML = `
                    <td style="${asgariUcretStyle}"><strong>${asgariUcretBadge}${personel.isim}</strong></td>
                    <td style="${asgariUcretStyle}">${personel.pozisyon}</td>
                    <td style="${asgariUcretStyle}">
                        <input type="number" class="ucret-input" value="${personel.brutMaas}" 
                               ${personel.isAsgariUcret ? 'readonly style="background: #fef3c7; border: 2px solid #fbbf24;"' : ''}
                               onchange="updatePersonelMaas('${firmaKey}', ${index}, 'brutMaas', this.value)">
                        ${personel.isAsgariUcret ? '<small style="color: #92400e; display: block;">Asgari Ücret</small>' : ''}
                    </td>
                    <td style="${asgariUcretStyle}">
                        <input type="number" class="gun-input" value="${personel.calistigiGun}" min="1" max="30"
                               onchange="updatePersonelMaas('${firmaKey}', ${index}, 'calistigiGun', this.value)">
                    </td>
                    <td class="hesaplanan" id="gunluk-${personel.id}" style="${asgariUcretStyle}">₺${(hesap.oranliMaas / Math.max(1, personel.calistigiGun)).toFixed(0)}</td>
                    <td class="hesaplanan pozitif" id="net-${personel.id}" style="${asgariUcretStyle}">
                        <strong>₺${hesap.netMaas.toFixed(0)}</strong>
                        ${personel.isAsgariUcret ? '<br><small style="color: #16a34a;">🛡️ Muafiyetli</small>' : ''}
                    </td>
                    <td class="${personel.isAsgariUcret ? 'asgari-muaf' : 'negatif'}" id="gelir-${personel.id}" style="${asgariUcretStyle}">
                        ${personel.isAsgariUcret ? '<span style="color: #16a34a;">🛡️ Muaf</span>' : '₺' + hesap.gelirVergisi.toFixed(0)}
                    </td>
                    <td class="${personel.isAsgariUcret ? 'asgari-muaf' : 'negatif'}" id="ssk-isc-${personel.id}" style="${asgariUcretStyle}">
                        ${personel.isAsgariUcret ? '<span style="color: #16a34a;">🛡️ Muaf</span>' : '₺' + hesap.sskIsci.toFixed(0)}
                    </td>
                    <td class="${personel.isAsgariUcret ? 'asgari-muaf' : 'negatif'}" id="damga-${personel.id}" style="${asgariUcretStyle}">
                        ${personel.isAsgariUcret ? '<span style="color: #16a34a;">🛡️ Muaf</span>' : '₺' + hesap.damgaVergisi.toFixed(0)}
                    </td>
                    <td class="negatif" id="muh-${personel.id}" style="${asgariUcretStyle}">₺${hesap.muhasebeParasi.toFixed(0)}</td>
                    <td class="${personel.isAsgariUcret ? 'asgari-muaf' : 'isci-kesinti'}" id="kesinti-${personel.id}" style="${asgariUcretStyle}">
                        ${personel.isAsgariUcret ? '<span style="color: #16a34a;">🛡️ Muaf</span>' : '₺' + hesap.toplamIsciKesinti.toFixed(0)}
                    </td>
                    <td class="${personel.isAsgariUcret ? 'asgari-muaf' : 'isveren-maliyet'}" id="ssk-isv-${personel.id}" style="${asgariUcretStyle}">
                        ${personel.isAsgariUcret ? '<span style="color: #16a34a;">🛡️ Muaf</span>' : '₺' + hesap.sskIsveren.toFixed(0)}
                    </td>
                    <td class="isveren-maliyet" id="maliyet-${personel.id}" style="${asgariUcretStyle}">
                        <strong>₺${hesap.toplamIsverenMaliyet.toFixed(0)}</strong>
                        ${personel.isAsgariUcret ? '<br><small style="color: #b45309;">Muhasebe + Muafiyet Farkı</small>' : ''}
                    </td>
                    <td>
                      <button class="btn" style="padding: 4px 8px; font-size: 12px; background: #3b82f6; margin-right: 5px;" onclick="showPersonelDetay('${personel.id}')">👁️ Detay</button>
                      <button class="btn" style="padding: 4px 8px; font-size: 12px; background: #ef4444;" onclick="deletePersonel('${firmaKey}', '${personel.id}')">🗑️ Sil</button>
                    </td>
                `;
          tbody.appendChild(row);
        });
      }

      // Personel maaş güncelleme
      function updatePersonelMaas(firmaKey, personelIndex, field, value) {
        firmaPersonelleri[firmaKey][personelIndex][field] = parseFloat(value);

        // Anlık güncelleme
        const personel = firmaPersonelleri[firmaKey][personelIndex];
        const hesap = hesaplaMaas(personel.brutMaas, personel.calistigiGun);

        const gunlukElement = document.getElementById(`gunluk-${personel.id}`);
        const netElement = document.getElementById(`net-${personel.id}`);
        const gelirElement = document.getElementById(`gelir-${personel.id}`);
        const sskIscElement = document.getElementById(`ssk-isc-${personel.id}`);
        const damgaElement = document.getElementById(`damga-${personel.id}`);
        const muhElement = document.getElementById(`muh-${personel.id}`);
        const kesintiElement = document.getElementById(
          `kesinti-${personel.id}`
        );
        const sskIsvElement = document.getElementById(`ssk-isv-${personel.id}`);
        const maliyetElement = document.getElementById(
          `maliyet-${personel.id}`
        );

        if (gunlukElement)
          gunlukElement.textContent = `₺${(
            hesap.oranliMaas / Math.max(1, personel.calistigiGun)
          ).toFixed(0)}`;
        if (netElement)
          netElement.innerHTML = `<strong>₺${hesap.netMaas.toFixed(0)}</strong>`;
        if (gelirElement)
          gelirElement.textContent = `₺${hesap.gelirVergisi.toFixed(0)}`;
        if (sskIscElement)
          sskIscElement.textContent = `₺${hesap.sskIsci.toFixed(0)}`;
        if (damgaElement)
          damgaElement.textContent = `₺${hesap.damgaVergisi.toFixed(0)}`;
        if (muhElement)
          muhElement.textContent = `₺${hesap.muhasebeParasi.toFixed(0)}`;
        if (kesintiElement)
          kesintiElement.textContent = `₺${hesap.toplamIsciKesinti.toFixed(0)}`;
        if (sskIsvElement)
          sskIsvElement.textContent = `₺${hesap.sskIsveren.toFixed(0)}`;
        if (maliyetElement)
          maliyetElement.innerHTML = `<strong>₺${hesap.toplamIsverenMaliyet.toFixed(0)}</strong>`;

        // Ana sayfayı güncelle (eğer açıksa)
        if (isAdmin) {
          updateAnaSayfa();
        }
      }

      // Personel detayı göster
      function showPersonelDetay(personelId) {
        // Personeli bul
        let personel = null;
        let firmaKey = null;

        Object.keys(firmaPersonelleri).forEach((key) => {
          const found = firmaPersonelleri[key].find((p) => p.id === personelId);
          if (found) {
            personel = found;
            firmaKey = key;
          }
        });

        if (personel) {
          const hesap = hesaplaMaas(personel.brutMaas, personel.calistigiGun);
          const toplamIsverenOdeme =
            hesap.oranliMaas + hesap.toplamIsverenMaliyet;

          // Basit modal oluştur
          const existing = document.getElementById('personelDetayModal');
          if (existing) existing.remove();
          const modal = document.createElement('div');
          modal.id = 'personelDetayModal';
          modal.style.position = 'fixed';
          modal.style.inset = '0';
          modal.style.background = 'rgba(0,0,0,0.6)';
          modal.style.zIndex = '1000';
          modal.innerHTML = `
            <div style="max-width: 900px; margin: 40px auto; background: #fff; border-radius: 10px; box-shadow: 0 10px 30px rgba(0,0,0,.2); overflow: hidden;">
              <div style="display:flex; justify-content: space-between; align-items:center; padding:16px 20px; background:#667eea; color:#fff;">
                <h3 style="margin:0;">${personel.isim} - Excel Formüllü Maaş Analizi</h3>
                <button onclick="document.getElementById('personelDetayModal').remove()" style="background:#ff4757; border:none; color:#fff; border-radius:6px; padding:6px 10px; cursor:pointer;">Kapat</button>
              </div>
              <div style="padding:20px;">
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:16px; margin-bottom:16px;">
                  <div>
                    <p><strong>Ad Soyad:</strong> ${personel.isim}</p>
                    <p><strong>Şirket:</strong> ${firmaConfig[firmaKey].name}</p>
                    <p><strong>Pozisyon:</strong> ${personel.pozisyon}</p>
                    <p><strong>Çalışılan Gün:</strong> ${personel.calistigiGun}/30</p>
                  </div>
                  <div>
                    <p><strong>Brüt Maaş:</strong> ₺${personel.brutMaas.toLocaleString('tr-TR')}</p>
                    <p><strong>Oranlı Maaş:</strong> ₺${hesap.oranliMaas.toFixed(2)}</p>
                    <p><strong>Günlük Tutar:</strong> ₺${(hesap.oranliMaas / Math.max(1, personel.calistigiGun)).toFixed(2)}</p>
                  </div>
                </div>

                <table style="width:100%; border-collapse:collapse;">
                  <thead>
                    <tr style="background:#f7f7ff;">
                      <th style="text-align:left; padding:10px;">Açıklama</th>
                      <th style="text-align:right; padding:10px;">Tutar (₺)</th>
                      <th style="text-align:left; padding:10px;">Oran/Formül</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr><td style="padding:8px;">Brüt Maaş (Aylık)</td><td style="padding:8px; text-align:right;">₺${personel.brutMaas.toLocaleString('tr-TR')}</td><td style="padding:8px;">Temel maaş</td></tr>
                    <tr><td style="padding:8px;">Çalıştığı Gün Oranı (${personel.calistigiGun}/30)</td><td style="padding:8px; text-align:right;">₺${hesap.oranliMaas.toFixed(2)}</td><td style="padding:8px;">=Brüt/30*${personel.calistigiGun}</td></tr>
                    <tr><td style="padding:8px;">Günlük Çalışma Tutarı</td><td style="padding:8px; text-align:right;">₺${(hesap.oranliMaas / Math.max(1, personel.calistigiGun)).toFixed(2)}</td><td style="padding:8px;">Oranlı / gün</td></tr>
                    <tr style="background:#f0f8ff;"><td colspan="3" style="padding:8px; font-weight:600;">İşçi Kesintileri</td></tr>
                    <tr><td style="padding:8px;">SSK İşçi + İşsizlik</td><td style="padding:8px; text-align:right; color:#dc3545;">-₺${hesap.sskIsci.toFixed(2)}</td><td style="padding:8px;">=Oranlı*15/100</td></tr>
                    <tr><td style="padding:8px;">Gelir Vergisi</td><td style="padding:8px; text-align:right; color:#dc3545;">-₺${hesap.gelirVergisi.toFixed(2)}</td><td style="padding:8px;">=(Oranlı-SSKİşçi)*20/100</td></tr>
                    <tr><td style="padding:8px;">Damga Vergisi</td><td style="padding:8px; text-align:right; color:#dc3545;">-₺${hesap.damgaVergisi.toFixed(2)}</td><td style="padding:8px;">=Oranlı*0.76/100</td></tr>
                    <tr style="background:#e7e3ff; font-weight:600;"><td>TOPLAM İŞÇİ KESİNTİSİ</td><td style="padding:8px; text-align:right; color:#dc3545;">-₺${hesap.toplamIsciKesinti.toFixed(2)}</td><td>%${((hesap.toplamIsciKesinti / hesap.oranliMaas) * 100).toFixed(1)}</td></tr>
                    <tr style="background:#e8f5e8; font-weight:600;"><td>NET MAAŞ</td><td style="padding:8px; text-align:right; color:#28a745;">₺${hesap.netMaas.toFixed(2)}</td><td>%${((hesap.netMaas / hesap.oranliMaas) * 100).toFixed(1)}</td></tr>
                    <tr style="background:#fff3cd;"><td colspan="3" style="padding:8px; font-weight:600;">İşveren Maliyetleri</td></tr>
                    <tr><td style="padding:8px;">İşveren SSK</td><td style="padding:8px; text-align:right; color:#fd7e14;">₺${hesap.sskIsveren.toFixed(2)}</td><td style="padding:8px;">=Oranlı*37.75/100</td></tr>
                    <tr><td style="padding:8px;">Gelir + Damga Vergisi</td><td style="padding:8px; text-align:right; color:#fd7e14;">₺${(hesap.gelirVergisi + hesap.damgaVergisi).toFixed(2)}</td><td style="padding:8px;">İşveren öder</td></tr>
                    <tr><td style="padding:8px;">Muhasebe</td><td style="padding:8px; text-align:right; color:#fd7e14;">₺${hesap.muhasebeParasi.toFixed(2)}</td><td style="padding:8px;">Sabit</td></tr>
                    <tr style="background:#fff3cd; font-weight:600;"><td>TOPLAM İŞVEREN MALİYETİ</td><td style="padding:8px; text-align:right; color:#fd7e14;">₺${hesap.toplamIsverenMaliyet.toFixed(2)}</td><td>Excel formülü</td></tr>
                    <tr style="font-weight:600;"><td>TOPLAM İŞVEREN ÖDEMESİ</td><td style="padding:8px; text-align:right;">₺${(hesap.netMaas + hesap.toplamIsverenMaliyet).toFixed(2)}</td><td>Net + Maliyet</td></tr>
                  </tbody>
                </table>
              </div>
            </div>`;
          document.body.appendChild(modal);
        }
      }

      // Yeni personel ekleme
      document.addEventListener('submit', function (e) {
        if (e.target.id === 'personelForm') {
          e.preventDefault();

          const formData = new FormData(e.target);
          const isAsgariUcret =
            document.getElementById('asgariUcretCheck').checked;

          const personelData = {
            id: 'p' + Date.now(),
            isim: formData.get('isim'),
            pozisyon: formData.get('pozisyon') || 'Personel',
            brutMaas: parseFloat(formData.get('brutMaas')) || 17002,
            calistigiGun: 22, // Varsayılan
            isAsgariUcret: isAsgariUcret, // Asgari ücret muafiyeti
            telefon: formData.get('telefon') || '',
            email: formData.get('email') || '',
          };

          let firma = formData.get('firma');
          if (!isAdmin) {
            firma = currentFirma;
          }

          if (firma && personelData.isim) {
            // Evrak validasyonunu kontrol et
            if (!evrakValidasyonu()) {
              return; // Form gönderimini durdur
            }

            if (!firmaPersonelleri[firma]) {
              firmaPersonelleri[firma] = [];
            }

            firmaPersonelleri[firma].push(personelData);

            // Personelin evraklarını kaydet
            savePersonelEvraklari(personelData.id);

            const hesap = hesaplaMaas(
              personelData.brutMaas,
              personelData.calistigiGun
            );
            alert(
              `✅ ${personelData.isim} başarıyla ${firmaConfig[firma].name} şirketine eklendi!\n\nNet Maaş: ₺${hesap.netMaas.toFixed(0)}`
            );

            e.target.reset();

            // Sayfayı yenile
            if (isAdmin) {
              updateAnaSayfa();
            } else {
              loadFirmaTable(currentFirma);
            }
          } else {
            alert('Lütfen şirket seçimi ve ad soyad alanlarını doldurun!');
          }
        }
      });

      // Tüm personel tablosunu yükle
      function loadTumPersonelTable() {
        const tbody = document.getElementById('tumPersonelBody');
        if (!tbody) return;

        let tumPersonelSayisi = 0;
        let aktifFirmaSayisi = 0;
        let toplamMaasBordrosu = 0;
        let toplamMaliyet = 0;
        let tableHTML = '';

        Object.keys(firmaPersonelleri).forEach((firmaKey) => {
          const personeller = firmaPersonelleri[firmaKey];
          if (personeller.length > 0) {
            aktifFirmaSayisi++;

            personeller.forEach((personel, index) => {
              tumPersonelSayisi++;
              const hesap = hesaplaMaas(
                personel.brutMaas,
                personel.calistigiGun
              );
              toplamMaasBordrosu += hesap.netMaas;
              toplamMaliyet += hesap.toplamIsverenMaliyet;

              // Firma rengine göre satır stili
              const firmaRengi = firmaConfig[firmaKey].color;

              tableHTML += `
                <tr style="border-left: 4px solid ${firmaRengi};">
                  <td><strong style="color: ${firmaRengi};">${firmaConfig[firmaKey].name}</strong></td>
                  <td><strong>${personel.isim}</strong></td>
                  <td>${personel.pozisyon}</td>
                  <td>₺${personel.brutMaas.toLocaleString('tr-TR')}</td>
                  <td>${personel.calistigiGun}</td>
                  <td class="pozitif"><strong>₺${hesap.netMaas.toFixed(0)}</strong></td>
                  <td class="negatif">₺${hesap.gelirVergisi.toFixed(0)}</td>
                  <td class="negatif">₺${hesap.sskIsci.toFixed(0)}</td>
                  <td class="negatif">₺${hesap.damgaVergisi.toFixed(0)}</td>
                  <td class="hesaplanan">₺${hesap.sskIsveren.toFixed(0)}</td>
                  <td class="hesaplanan"><strong>₺${hesap.toplamIsverenMaliyet.toFixed(0)}</strong></td>
                  <td>
                    <button onclick="showPersonelDetay('${personel.id}')" style="padding: 4px 8px; background: #3b82f6; color: white; border: none; border-radius: 4px; margin-right: 5px;">👁️</button>
                    <button onclick="deletePersonel('${firmaKey}', '${personel.id}')" style="padding: 4px 8px; background: #ef4444; color: white; border: none; border-radius: 4px;">🗑️</button>
                  </td>
                </tr>
              `;
            });
          }
        });

        tbody.innerHTML = tableHTML;

        // İstatistikleri güncelle
        document.getElementById('tumPersonelSayisi').textContent =
          tumPersonelSayisi;
        document.getElementById('aktifFirmaSayisi').textContent =
          aktifFirmaSayisi;
        document.getElementById('toplamMaasBordrosu').textContent =
          `₺${toplamMaasBordrosu.toFixed(0)}`;
        document.getElementById('toplamMaliyet').textContent =
          `₺${toplamMaliyet.toFixed(0)}`;
      }

      // Personel silme fonksiyonu
      function deletePersonel(firmaKey, personelId) {
        if (confirm('Bu personeli silmek istediğinizden emin misiniz?')) {
          const personelIndex = firmaPersonelleri[firmaKey].findIndex(
            (p) => p.id === personelId
          );
          if (personelIndex !== -1) {
            const silinecekPersonel =
              firmaPersonelleri[firmaKey][personelIndex];
            firmaPersonelleri[firmaKey].splice(personelIndex, 1);

            // Activity log ekle
            addActivityLog(
              `${silinecekPersonel.isim} personeli ${firmaConfig[firmaKey].name} şirketinden silindi`
            );

            alert(`${silinecekPersonel.isim} başarıyla silindi.`);

            // Tabloları yenile
            if (document.getElementById('tumPersonelBody')) {
              loadTumPersonelTable();
            }
            if (isAdmin) {
              updateAnaSayfa();
            }
          }
        }
      }

      // Yönetim panelini yükle
      function loadYonetimPaneli() {
        loadUserManagement();
        loadFirmaManagement();
        loadEvrakYonetimi();
        loadActivityLog();
      }

      // Kullanıcı yönetimini yükle
      function loadUserManagement() {
        const area = document.getElementById('userManagementArea');
        if (!area) return;

        const users = [
          {
            id: 'admin',
            email: 'admin@hcsigorta.com',
            name: 'Sistem Yöneticisi',
            role: 'admin',
            firma: 'Tümü',
          },
          {
            id: 'klinik',
            email: 'klinik@hcsigorta.com',
            name: 'HC Klinik Kullanıcısı',
            role: 'user',
            firma: 'HC Klinik',
          },
          {
            id: 'lab',
            email: 'lab@hcsigorta.com',
            name: 'HC Lab Kullanıcısı',
            role: 'user',
            firma: 'HC Lab',
          },
          {
            id: 'eczane',
            email: 'eczane@hcsigorta.com',
            name: 'HC Eczane Kullanıcısı',
            role: 'user',
            firma: 'HC Eczane',
          },
        ];

        let usersHTML = `
          <div style="max-height: 300px; overflow-y: auto;">
            <table style="width: 100%; font-size: 12px;">
              <thead>
                <tr style="background: #2d3748; color: white;">
                  <th style="padding: 8px; text-align: left; color: white; font-weight: bold;">Kullanıcı</th>
                  <th style="padding: 8px; text-align: left; color: white; font-weight: bold;">Firma</th>
                  <th style="padding: 8px; text-align: left; color: white; font-weight: bold;">Rol</th>
                  <th style="padding: 8px; text-align: center; color: white; font-weight: bold;">İşlemler</th>
                </tr>
              </thead>
              <tbody>
        `;

        users.forEach((user) => {
          usersHTML += `
            <tr style="background: ${user.role === 'admin' ? '#fff5f5' : '#f0fff4'}; border-bottom: 1px solid #e2e8f0;">
              <td style="padding: 8px; color: #2d3748;"><strong>${user.name}</strong><br><small style="color: #4a5568;">${user.email}</small></td>
              <td style="padding: 8px; color: #2d3748; font-weight: 600;">${user.firma}</td>
              <td style="padding: 8px;">
                <span style="background: ${user.role === 'admin' ? '#dc2626' : '#059669'}; color: white; padding: 3px 8px; border-radius: 6px; font-size: 11px; font-weight: bold; text-shadow: 0 1px 2px rgba(0,0,0,0.3);">
                  ${user.role === 'admin' ? '🔑 Admin' : '👤 Kullanıcı'}
                </span>
              </td>
              <td style="padding: 8px; text-align: center;">
                <button onclick="editUser('${user.id}')" style="padding: 4px 8px; background: #1d4ed8; color: white; border: none; border-radius: 4px; margin-right: 5px; font-weight: bold; text-shadow: 0 1px 2px rgba(0,0,0,0.3);">✏️</button>
                <button onclick="deleteUser('${user.id}')" style="padding: 4px 8px; background: #dc2626; color: white; border: none; border-radius: 4px; font-weight: bold; text-shadow: 0 1px 2px rgba(0,0,0,0.3);">🗑️</button>
              </td>
            </tr>
          `;
        });

        usersHTML += `
              </tbody>
            </table>
          </div>
        `;

        area.innerHTML = usersHTML;
      }

      // Firma yönetimini yükle
      function loadFirmaManagement() {
        const area = document.getElementById('firmaManagementArea');
        if (!area) return;

        let firmaHTML = `
          <div style="max-height: 300px; overflow-y: auto;">
        `;

        Object.keys(firmaConfig).forEach((firmaKey) => {
          const firma = firmaConfig[firmaKey];
          const personelSayisi = firmaPersonelleri[firmaKey]
            ? firmaPersonelleri[firmaKey].length
            : 0;

          firmaHTML += `
            <div style="background: linear-gradient(135deg, ${firma.color}15, ${firma.color}08); padding: 12px; margin-bottom: 10px; border-radius: 8px; border-left: 4px solid ${firma.color}; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                  <strong style="color: #1a202c; font-size: 14px;">${firma.name}</strong><br>
                  <small style="color: #4a5568; font-weight: 600;">${personelSayisi} personel</small>
                </div>
                <div>
                  <button onclick="editFirma('${firmaKey}')" style="padding: 6px 10px; background: #1d4ed8; color: white; border: none; border-radius: 6px; margin-right: 5px; font-weight: bold; text-shadow: 0 1px 2px rgba(0,0,0,0.3); box-shadow: 0 2px 4px rgba(29, 78, 216, 0.3);">✏️</button>
                  <button onclick="deleteFirma('${firmaKey}')" style="padding: 6px 10px; background: #dc2626; color: white; border: none; border-radius: 6px; font-weight: bold; text-shadow: 0 1px 2px rgba(0,0,0,0.3); box-shadow: 0 2px 4px rgba(220, 38, 38, 0.3);">🗑️</button>
                </div>
              </div>
            </div>
          `;
        });

        firmaHTML += `</div>`;
        area.innerHTML = firmaHTML;
      }

      // Evrak Yönetimi fonksiyonları
      function loadEvrakYonetimi() {
        const area = document.getElementById('evrakYonetimArea');
        if (!area) return;

        // İstatistikleri hesapla
        let toplamPersonelEvrak = 0;
        let toplamEvrakSayisi = 0;
        let eksikEvrakSayisi = 0;

        const personelListesi = [];

        // Tüm firmalardan personelleri topla
        Object.keys(firmaPersonelleri).forEach((firmaKey) => {
          const personeller = firmaPersonelleri[firmaKey] || [];
          personeller.forEach((personel) => {
            const personelEvrak = personelEvraklari[personel.id] || {};
            const evrakSayisi = Object.keys(personelEvrak).reduce(
              (sum, evrakTuru) => {
                return sum + personelEvrak[evrakTuru].files.length;
              },
              0
            );

            if (evrakSayisi > 0) toplamPersonelEvrak++;
            toplamEvrakSayisi += evrakSayisi;

            // Eksik zorunlu evrakları kontrol et
            const zorunluEvraklar = ['kimlikBelgesi', 'adliSicilKaydi'];
            let eksikZorunluEvrak = false;
            zorunluEvraklar.forEach((evrak) => {
              if (
                !personelEvrak[evrak] ||
                personelEvrak[evrak].files.length === 0
              ) {
                eksikZorunluEvrak = true;
              }
            });
            if (eksikZorunluEvrak) eksikEvrakSayisi++;

            personelListesi.push({
              ...personel,
              firmaKey,
              firmaAdi: firmaConfig[firmaKey].name,
              firmaColor: firmaConfig[firmaKey].color,
              evrakSayisi,
              eksikZorunluEvrak,
            });
          });
        });

        // İstatistikleri güncelle
        document.getElementById('toplamPersonelEvrak').textContent =
          toplamPersonelEvrak;
        document.getElementById('toplamEvrakSayisi').textContent =
          toplamEvrakSayisi;
        document.getElementById('eksikEvrakSayisi').textContent =
          eksikEvrakSayisi;

        // Personel evrak tablosunu oluştur
        let evrakHTML = `
          <div style="max-height: 400px; overflow-y: auto;">
            <table style="width: 100%; font-size: 12px; border-collapse: collapse;">
              <thead style="background: #f8f9fa; position: sticky; top: 0;">
                <tr>
                  <th style="padding: 8px; text-align: left; border: 1px solid #ddd; font-weight: bold; color: #374151;">👤 Personel</th>
                  <th style="padding: 8px; text-align: left; border: 1px solid #ddd; font-weight: bold; color: #374151;">🏢 Firma</th>
                  <th style="padding: 8px; text-align: center; border: 1px solid #ddd; font-weight: bold; color: #374151;">📄 Evrak Sayısı</th>
                  <th style="padding: 8px; text-align: center; border: 1px solid #ddd; font-weight: bold; color: #374151;">⚠️ Durum</th>
                  <th style="padding: 8px; text-align: center; border: 1px solid #ddd; font-weight: bold; color: #374151;">🛠️ İşlemler</th>
                </tr>
              </thead>
              <tbody>
        `;

        if (personelListesi.length === 0) {
          evrakHTML += `
            <tr>
              <td colspan="5" style="padding: 20px; text-align: center; color: #6b7280;">
                📋 Henüz evraklı personel bulunmuyor
              </td>
            </tr>
          `;
        } else {
          personelListesi.forEach((personel) => {
            const statusBadge = personel.eksikZorunluEvrak
              ? '<span style="background: #fef2f2; color: #dc2626; padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: bold;">⚠️ Eksik Belge</span>'
              : '<span style="background: #f0fdf4; color: #059669; padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: bold;">✅ Tamamlandı</span>';

            evrakHTML += `
              <tr style="border-bottom: 1px solid #e5e7eb;">
                <td style="padding: 8px; border: 1px solid #ddd;">
                  <div style="font-weight: bold; color: #1f2937;">${personel.isim}</div>
                  <small style="color: #6b7280;">${personel.pozisyon || 'Personel'}</small>
                </td>
                <td style="padding: 8px; border: 1px solid #ddd;">
                  <span style="color: ${personel.firmaColor}; font-weight: bold;">${personel.firmaAdi}</span>
                </td>
                <td style="padding: 8px; text-align: center; border: 1px solid #ddd; font-weight: bold; color: #059669;">
                  ${personel.evrakSayisi}
                </td>
                <td style="padding: 8px; text-align: center; border: 1px solid #ddd;">
                  ${statusBadge}
                </td>
                <td style="padding: 8px; text-align: center; border: 1px solid #ddd;">
                  <div style="display: flex; gap: 3px; justify-content: center; flex-wrap: wrap;">
                    <button onclick="evrakDetayGoster('${personel.id}')" 
                            style="padding: 3px 6px; background: #3b82f6; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 10px;">
                      👁️ Detay
                    </button>
                    <button onclick="indirPersonelEvraklari('${personel.id}')" 
                            style="padding: 3px 6px; background: #059669; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 10px;">
                      📥 İndir
                    </button>
                    <button onclick="paylaşPersonelEvrak('${personel.id}')" 
                            style="padding: 3px 6px; background: #7c3aed; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 10px;">
                      📤 Paylaş
                    </button>
                  </div>
                </td>
              </tr>
            `;
          });
        }

        evrakHTML += `
              </tbody>
            </table>
          </div>
        `;

        area.innerHTML = evrakHTML;
      }

      function evrakDetayGoster(personelId) {
        const evraklar = personelEvraklari[personelId];
        if (!evraklar || Object.keys(evraklar).length === 0) {
          alert('Bu personele ait evrak bulunmuyor.');
          return;
        }

        let detayHTML = `
          <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; display: flex; justify-content: center; align-items: center;">
            <div style="background: white; padding: 25px; border-radius: 15px; max-width: 800px; width: 90%; max-height: 80vh; overflow-y: auto;">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="margin: 0; color: #1f2937;">📎 ${personelId} - Evrak Detayları</h3>
                <button onclick="this.closest('div[style*=\"position: fixed\"]').remove()" 
                        style="background: #ef4444; color: white; border: none; border-radius: 50%; width: 30px; height: 30px; cursor: pointer;">✕</button>
              </div>
              
              <div style="display: grid; grid-template-columns: 1fr; gap: 15px;">
        `;

        Object.keys(evraklar).forEach((evrakTuru) => {
          const evrak = evraklar[evrakTuru];
          const evrakTipi = evrakTurleri[evrakTuru];

          detayHTML += `
            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #059669;">
              <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;">
                <div>
                  <h4 style="margin: 0 0 5px 0; color: #059669;">${evrakTipi.icon} ${evrakTipi.name}</h4>
                  <small style="color: #6b7280;">📅 Yükleme: ${new Date(evrak.yuklenmeTarihi).toLocaleString('tr-TR')} | 🏢 ${evrak.yukleyenFirma}</small>
                </div>
                <div style="display: flex; gap: 5px;">
                  <button onclick="indirPersonelEvraklari('${personelId}', '${evrakTuru}')" 
                          style="padding: 5px 10px; background: #059669; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 11px;">
                    📥 İndir
                  </button>
                </div>
              </div>
              <div style="display: grid; gap: 8px;">
          `;

          evrak.files.forEach((file, index) => {
            detayHTML += `
              <div style="background: white; padding: 8px; border-radius: 4px; display: flex; justify-content: space-between; align-items: center;">
                <div>
                  <span style="font-weight: bold; color: #1f2937;">📄 ${file.name}</span>
                  <small style="color: #6b7280; margin-left: 10px;">(${(file.size / 1024).toFixed(1)}KB)</small>
                </div>
                <div style="display: flex; gap: 5px;">
                  <button onclick="paylaşWhatsApp('📄 ${evrakTipi.name} - ${file.name}\\n\\nPersonel: ${personelId}\\nYükleme Tarihi: ${new Date(evrak.yuklenmeTarihi).toLocaleString('tr-TR')}\\n\\nHC Sigorta Evrak Sistemi')" 
                          style="padding: 3px 6px; background: #25d366; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 10px;">
                    📱 WhatsApp
                  </button>
                  <button onclick="paylaşGmail('📄 ${evrakTipi.name} - ${file.name}\\n\\nPersonel: ${personelId}\\nYükleme Tarihi: ${new Date(evrak.yuklenmeTarihi).toLocaleString('tr-TR')}\\n\\nHC Sigorta Evrak Sistemi', '', '${evrakTipi.name} - ${personelId}')" 
                          style="padding: 3px 6px; background: #ea4335; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 10px;">
                    📧 Gmail
                  </button>
                </div>
              </div>
            `;
          });

          detayHTML += `
              </div>
            </div>
          `;
        });

        detayHTML += `
              </div>
            </div>
          </div>
        `;

        document.body.insertAdjacentHTML('beforeend', detayHTML);
      }

      function paylaşPersonelEvrak(personelId) {
        const evraklar = personelEvraklari[personelId];
        if (!evraklar) {
          alert('Bu personele ait evrak bulunmuyor.');
          return;
        }

        const toplamDosya = Object.values(evraklar).reduce(
          (sum, evrak) => sum + evrak.files.length,
          0
        );
        const evrakListesi = Object.keys(evraklar)
          .map(
            (tur) =>
              `• ${evrakTurleri[tur].name}: ${evraklar[tur].files.length} dosya`
          )
          .join('\\n');

        const mesaj = `📄 HC Sigorta - Personel Evrakları
        
👤 Personel: ${personelId}
📊 Toplam Dosya: ${toplamDosya}

📋 Evrak Türleri:
${evrakListesi}

📅 Rapor Tarihi: ${new Date().toLocaleString('tr-TR')}

🏥 HC Sigorta Personel Yönetim Sistemi`;

        const paylaşimModal = `
          <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; display: flex; justify-content: center; align-items: center;">
            <div style="background: white; padding: 25px; border-radius: 15px; max-width: 500px; width: 90%;">
              <h3 style="margin: 0 0 20px 0; color: #1f2937;">📤 Evrakları Paylaş</h3>
              
              <div style="margin-bottom: 15px;">
                <label style="display: block; font-weight: bold; margin-bottom: 5px; color: #374151;">📱 WhatsApp Telefon:</label>
                <input type="tel" id="whatsappTelefon" placeholder="+90 5xx xxx xxxx" style="width: 100%; padding: 8px; border: 2px solid #d1d5db; border-radius: 6px;">
              </div>
              
              <div style="margin-bottom: 20px;">
                <label style="display: block; font-weight: bold; margin-bottom: 5px; color: #374151;">📧 Gmail E-posta:</label>
                <input type="email" id="gmailEmail" placeholder="ornek@gmail.com" style="width: 100%; padding: 8px; border: 2px solid #d1d5db; border-radius: 6px;">
              </div>
              
              <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button onclick="this.closest('div[style*=\"position: fixed\"]').remove()" style="padding: 8px 15px; background: #6b7280; color: white; border: none; border-radius: 6px; cursor: pointer;">İptal</button>
                <button onclick="paylaşWhatsApp('${mesaj}', document.getElementById('whatsappTelefon').value); this.closest('div[style*=\"position: fixed\"]').remove();" style="padding: 8px 15px; background: #25d366; color: white; border: none; border-radius: 6px; cursor: pointer;">📱 WhatsApp Gönder</button>
                <button onclick="paylaşGmail('${mesaj}', document.getElementById('gmailEmail').value, 'Personel Evrakları - ${personelId}'); this.closest('div[style*=\"position: fixed\"]').remove();" style="padding: 8px 15px; background: #ea4335; color: white; border: none; border-radius: 6px; cursor: pointer;">📧 Gmail Gönder</button>
              </div>
            </div>
          </div>
        `;

        document.body.insertAdjacentHTML('beforeend', paylaşimModal);
      }

      function exportAllEvraklar() {
        const toplamPersonel = Object.keys(personelEvraklari).length;
        const toplamEvrak = Object.values(personelEvraklari).reduce(
          (sum, evraklar) => {
            return (
              sum +
              Object.values(evraklar).reduce(
                (sum2, evrak) => sum2 + evrak.files.length,
                0
              )
            );
          },
          0
        );

        alert(`📥 Tüm Evraklar Dışa Aktarılıyor...

📊 İstatistikler:
👤 ${toplamPersonel} personel
📄 ${toplamEvrak} evrak dosyası

📁 Çıktı: HC_Sigorta_TumEvraklar_${new Date().getFullYear()}-${(new Date().getMonth() + 1).toString().padStart(2, '0')}-${new Date().getDate().toString().padStart(2, '0')}.zip

Tüm evraklar ZIP dosyası halinde indiriliyor...`);

        addActivityLog(
          `Tüm evraklar dışa aktarıldı (${toplamPersonel} personel, ${toplamEvrak} dosya)`
        );
      }

      function evrakIstatistikleri() {
        let rapor = '📊 EVRAK YÖNETİMİ İSTATİSTİKLERİ\n';
        rapor += '='.repeat(40) + '\n\n';

        const evrakTurleriIstatistik = {};
        let toplamPersonel = 0;
        let toplamEvrak = 0;

        Object.keys(personelEvraklari).forEach((personelId) => {
          toplamPersonel++;
          const evraklar = personelEvraklari[personelId];

          Object.keys(evraklar).forEach((evrakTuru) => {
            if (!evrakTurleriIstatistik[evrakTuru]) {
              evrakTurleriIstatistik[evrakTuru] = { personel: 0, dosya: 0 };
            }
            evrakTurleriIstatistik[evrakTuru].personel++;
            evrakTurleriIstatistik[evrakTuru].dosya +=
              evraklar[evrakTuru].files.length;
            toplamEvrak += evraklar[evrakTuru].files.length;
          });
        });

        rapor += `📈 GENEL İSTATİSTİKLER:\n`;
        rapor += `👤 Evraklı Personel: ${toplamPersonel}\n`;
        rapor += `📄 Toplam Evrak: ${toplamEvrak}\n\n`;

        rapor += `📋 EVRAK TÜRLERİNE GÖRE:\n`;
        Object.keys(evrakTurleriIstatistik).forEach((evrakTuru) => {
          const istatistik = evrakTurleriIstatistik[evrakTuru];
          const evrakTipi = evrakTurleri[evrakTuru];
          rapor += `${evrakTipi.icon} ${evrakTipi.name}: ${istatistik.personel} personel, ${istatistik.dosya} dosya\n`;
        });

        rapor += `\n📅 Rapor Tarihi: ${new Date().toLocaleString('tr-TR')}`;

        alert(rapor);
        addActivityLog('Evrak istatistikleri raporu görüntülendi');
      }

      // Activity log sistemі
      let activityLog = [];

      function addActivityLog(message) {
        const timestamp = new Date().toLocaleString('tr-TR');
        activityLog.unshift({
          message,
          timestamp,
          user: currentUser || 'Sistem',
        });

        // Son 50 kaydı tut
        if (activityLog.length > 50) {
          activityLog = activityLog.slice(0, 50);
        }
      }

      function loadActivityLog() {
        const area = document.getElementById('activityLogArea');
        if (!area) return;

        let logHTML = '';
        if (activityLog.length === 0) {
          logHTML =
            '<div style="text-align: center; padding: 20px; background: #f7fafc; border-radius: 8px; color: #4a5568; font-weight: 600;">📋 Henüz aktivite yok</div>';
        } else {
          activityLog.forEach((log, index) => {
            const isEven = index % 2 === 0;
            logHTML += `
              <div style="padding: 12px; border-bottom: 1px solid #e2e8f0; font-size: 12px; background: ${isEven ? '#f8fafc' : '#ffffff'}; border-radius: 4px; margin-bottom: 2px;">
                <div style="color: #1a202c; font-weight: bold; margin-bottom: 4px;">📌 ${log.message}</div>
                <div style="color: #4a5568; font-size: 10px; font-weight: 600;">🕒 ${log.timestamp} • 👤 ${log.user}</div>
              </div>
            `;
          });
        }
        area.innerHTML = logHTML;
      }

      // Kullanıcı ayarlarını yükle (Normal kullanıcılar için)
      function loadKullaniciAyarlari() {
        loadUserInfo();
        loadFirmUsers();
        loadUserActivityLog();

        // Şifre değiştirme form event'i ekle
        const passwordForm = document.getElementById('passwordChangeForm');
        if (passwordForm) {
          passwordForm.addEventListener('submit', function (e) {
            e.preventDefault();
            changePassword();
          });
        }
      }

      function loadUserInfo() {
        const area = document.getElementById('userInfoArea');
        if (!area) return;

        const userInfo = `
          <div style="background: linear-gradient(135deg, #e6f3ff, #f0f9ff); padding: 15px; border-radius: 8px; margin-bottom: 15px; border: 1px solid #bfdbfe;">
            <div style="color: #1e40af; font-weight: bold; margin-bottom: 8px;"><strong>👤 Kullanıcı Adı:</strong> ${currentUser}</div>
            <div style="color: #1e40af; font-weight: bold; margin-bottom: 8px;"><strong>🏢 Firma:</strong> ${firmaConfig[currentFirma].name}</div>
            <div style="color: #1e40af; font-weight: bold; margin-bottom: 8px;"><strong>🔐 Yetki Seviyesi:</strong> <span style="background: #059669; color: white; padding: 3px 8px; border-radius: 6px; font-size: 12px; font-weight: bold; text-shadow: 0 1px 2px rgba(0,0,0,0.3);">👤 Kullanıcı</span></div>
            <div style="color: #1e40af; font-weight: bold;"><strong>🕒 Son Giriş:</strong> ${new Date().toLocaleString('tr-TR')}</div>
          </div>
        `;
        area.innerHTML = userInfo;
      }

      function loadFirmUsers() {
        const area = document.getElementById('firmUserListArea');
        if (!area) return;

        // Bu firma için örnek kullanıcıları göster (gerçek uygulamada API'den gelir)
        const firmUsers = [
          {
            name: `${firmaConfig[currentFirma].name} Müdürü`,
            email: `mudur@${currentFirma}.com`,
            role: 'Yönetici',
          },
          {
            name: `${firmaConfig[currentFirma].name} Kullanıcısı`,
            email: `kullanici@${currentFirma}.com`,
            role: 'Kullanıcı',
          },
        ];

        let usersHTML = '<div style="font-size: 12px;">';
        firmUsers.forEach((user) => {
          usersHTML += `
            <div style="background: #f8f9fa; padding: 8px; margin-bottom: 8px; border-radius: 6px; display: flex; justify-content: space-between; align-items: center;">
              <div>
                <div><strong>${user.name}</strong></div>
                <div style="color: #666; font-size: 10px;">${user.email}</div>
              </div>
              <div>
                <span style="background: #3b82f6; color: white; padding: 2px 6px; border-radius: 4px; font-size: 10px;">${user.role}</span>
              </div>
            </div>
          `;
        });
        usersHTML += '</div>';

        area.innerHTML = usersHTML;
      }

      function loadUserActivityLog() {
        const area = document.getElementById('userActivityLogArea');
        if (!area) return;

        // Bu kullanıcının aktivitelerini filtrele
        const userActivities = activityLog.filter(
          (log) => log.user === currentUser
        );

        let logHTML = '';
        if (userActivities.length === 0) {
          logHTML =
            '<div style="text-align: center; padding: 15px; background: #fef3c7; border-radius: 8px; color: #92400e; font-weight: 600; font-size: 12px;">⚠️ Henüz kişisel aktivite yok</div>';
        } else {
          userActivities.forEach((log, index) => {
            const isEven = index % 2 === 0;
            logHTML += `
              <div style="padding: 10px; border-bottom: 1px solid #e5e7eb; font-size: 11px; background: ${isEven ? '#f9fafb' : '#ffffff'}; border-radius: 4px; margin-bottom: 2px;">
                <div style="color: #111827; font-weight: bold; margin-bottom: 3px;">✅ ${log.message}</div>
                <div style="color: #6b7280; font-size: 10px; font-weight: 600;">📅 ${log.timestamp}</div>
              </div>
            `;
          });
        }
        area.innerHTML = logHTML;
      }

      function changePassword() {
        const currentPass = document.getElementById('currentPassword').value;
        const newPass = document.getElementById('newPassword').value;
        const confirmPass = document.getElementById('confirmPassword').value;

        if (!currentPass || !newPass || !confirmPass) {
          alert('Lütfen tüm alanları doldurun!');
          return;
        }

        if (newPass !== confirmPass) {
          alert('Yeni şifreler eşleşmiyor!');
          return;
        }

        if (newPass.length < 6) {
          alert('Yeni şifre en az 6 karakter olmalıdır!');
          return;
        }

        // Demo için basit kontrol
        if (currentPass !== '123456' && currentPass !== 'admin123') {
          alert('Mevcut şifre hatalı!');
          return;
        }

        alert(
          'Şifre başarıyla değiştirildi! Yeni şifreniz ile giriş yapabilirsiniz.'
        );
        addActivityLog(`Şifre değiştirildi`);

        // Formu temizle
        document.getElementById('passwordChangeForm').reset();
      }

      function showAddUserForm() {
        const userName = prompt('Yeni kullanıcı adı:');
        const userEmail = prompt('Yeni kullanıcı e-mail:');

        if (userName && userEmail) {
          alert(
            `${userName} kullanıcısı başarıyla sisteme eklendi!`
          );
          addActivityLog(`Yeni kullanıcı eklendi: ${userName} (${userEmail})`);
          loadFirmUsers(); // Listeyi yenile
        }
      }

      // Yönetim buton fonksiyonları (Admin için)
      function showUserAddForm() {
        const userForm = `
          <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; display: flex; justify-content: center; align-items: center;">
            <div style="background: white; padding: 30px; border-radius: 15px; max-width: 500px; width: 90%;">
              <h3 style="margin-bottom: 20px; color: #333;">➕ Yeni Sistem Kullanıcısı Ekle</h3>
              <form id="newUserForm">
                <div style="margin-bottom: 15px;">
                  <label style="display: block; margin-bottom: 5px; font-weight: 600;">Ad Soyad:</label>
                  <input type="text" id="newUserName" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px;" required>
                </div>
                <div style="margin-bottom: 15px;">
                  <label style="display: block; margin-bottom: 5px; font-weight: 600;">E-mail:</label>
                  <input type="email" id="newUserEmail" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px;" required>
                </div>
                <div style="margin-bottom: 15px;">
                  <label style="display: block; margin-bottom: 5px; font-weight: 600;">Şifre:</label>
                  <input type="password" id="newUserPassword" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px;" value="123456" required>
                </div>
                <div style="margin-bottom: 15px;">
                  <label style="display: block; margin-bottom: 5px; font-weight: 600;">Yetki Seviyesi:</label>
                  <select id="newUserRole" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px;">
                    <option value="user">Kullanıcı</option>
                    <option value="admin">Yönetici</option>
                  </select>
                </div>
                <div style="margin-bottom: 20px;">
                  <label style="display: block; margin-bottom: 5px; font-weight: 600;">Firma Erişimi:</label>
                  <select id="newUserFirma" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px;">
                    <option value="all">Tüm Firmalar (Admin)</option>
                    ${Object.keys(firmaConfig)
                      .map(
                        (key) =>
                          `<option value="${key}">${firmaConfig[key].name}</option>`
                      )
                      .join('')}
                  </select>
                </div>
                <div style="display: flex; gap: 10px;">
                  <button type="submit" class="btn" style="background: #10b981;">✅ Kullanıcı Ekle</button>
                  <button type="button" onclick="closeUserForm()" class="btn" style="background: #ef4444;">❌ İptal</button>
                </div>
              </form>
            </div>
          </div>
        `;

        document.body.insertAdjacentHTML('beforeend', userForm);

        document
          .getElementById('newUserForm')
          .addEventListener('submit', function (e) {
            e.preventDefault();

            const name = document.getElementById('newUserName').value;
            const email = document.getElementById('newUserEmail').value;
            const password = document.getElementById('newUserPassword').value;
            const role = document.getElementById('newUserRole').value;
            const firma = document.getElementById('newUserFirma').value;

            alert(`✅ Yeni kullanıcı eklendi:
📧 ${email}
👤 ${name}
🔑 ${role === 'admin' ? 'Yönetici' : 'Kullanıcı'}
🏢 ${firma === 'all' ? 'Tüm Firmalar' : firmaConfig[firma]?.name}

Kullanıcı sisteme başarıyla kaydedildi.`);

            addActivityLog(
              `Yeni ${role} kullanıcısı eklendi: ${name} (${email})`
            );
            closeUserForm();
            loadUserManagement();
          });
      }

      function closeUserForm() {
        const form = document
          .querySelector('[id="newUserForm"]')
          .closest('div[style*="position: fixed"]');
        if (form) form.remove();
      }

      function refreshUserList() {
        console.log('refreshUserList çağrıldı!');
        loadUserManagement();
        addActivityLog('Kullanıcı listesi yenilendi');
        alert('✅ Kullanıcı listesi başarıyla yenilendi!');
      }

      function showFirmaAddForm() {
        const firmaForm = `
          <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; display: flex; justify-content: center; align-items: center;">
            <div style="background: white; padding: 30px; border-radius: 15px; max-width: 500px; width: 90%;">
              <h3 style="margin-bottom: 20px; color: #333;">🏢 Yeni İşletme Ekle</h3>
              <form id="newFirmaForm">
                <div style="margin-bottom: 15px;">
                  <label style="display: block; margin-bottom: 5px; font-weight: 600;">İşletme Adı:</label>
                  <input type="text" id="newFirmaName" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px;" placeholder="Örn: HC Muhasebe" required>
                </div>
                <div style="margin-bottom: 15px;">
                  <label style="display: block; margin-bottom: 5px; font-weight: 600;">İşletme Kodu:</label>
                  <input type="text" id="newFirmaKey" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px;" placeholder="Örn: hc-muhasebe" required>
                </div>
                <div style="margin-bottom: 15px;">
                  <label style="display: block; margin-bottom: 5px; font-weight: 600;">Renk Kodu:</label>
                  <input type="color" id="newFirmaColor" style="width: 100%; height: 40px; border: 2px solid #ddd; border-radius: 8px;" value="#6366f1" required>
                </div>
                <div style="margin-bottom: 15px;">
                  <label style="display: block; margin-bottom: 5px; font-weight: 600;">İkon:</label>
                  <input type="text" id="newFirmaIcon" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px;" placeholder="🏢" maxlength="2" required>
                </div>
                <div style="display: flex; gap: 10px;">
                  <button type="submit" class="btn" style="background: #10b981;">✅ İşletme Ekle</button>
                  <button type="button" onclick="closeFirmaForm()" class="btn" style="background: #ef4444;">❌ İptal</button>
                </div>
              </form>
            </div>
          </div>
        `;

        document.body.insertAdjacentHTML('beforeend', firmaForm);

        document
          .getElementById('newFirmaForm')
          .addEventListener('submit', function (e) {
            e.preventDefault();

            const name = document.getElementById('newFirmaName').value;
            const key = document.getElementById('newFirmaKey').value;
            const color = document.getElementById('newFirmaColor').value;
            const icon = document.getElementById('newFirmaIcon').value;

            // Yeni firmayı konfigürasyona ekle (demo için)
            firmaConfig[key] = {
              name: `${icon} ${name}`,
              color: color,
            };

            // Boş personel listesi oluştur
            firmaPersonelleri[key] = [];

            alert(`✅ Yeni işletme eklendi:
🏢 ${name}
🔑 Kod: ${key}
🎨 Renk: ${color}
${icon} İkon: ${icon}

İşletme sisteme başarıyla kaydedildi.`);

            addActivityLog(`Yeni işletme eklendi: ${name} (${key})`);
            closeFirmaForm();
            loadFirmaManagement();
          });
      }

      function closeFirmaForm() {
        const form = document
          .querySelector('[id="newFirmaForm"]')
          .closest('div[style*="position: fixed"]');
        if (form) form.remove();
      }

      function exportAllData() {
        let exportData = {
          tarih: new Date().toLocaleString('tr-TR'),
          firmalar: {},
          toplam: {
            personelSayisi: 0,
            toplamBrutMaas: 0,
            toplamNetMaas: 0,
            toplamIsverenMaliyet: 0,
          },
        };

        Object.keys(firmaPersonelleri).forEach((firmaKey) => {
          const personeller = firmaPersonelleri[firmaKey];
          if (personeller.length > 0) {
            exportData.firmalar[firmaKey] = {
              firmaAdi: firmaConfig[firmaKey].name,
              personeller: personeller.map((p) => {
                const hesap = hesaplaMaas(p.brutMaas, p.calistigiGun);
                exportData.toplam.personelSayisi++;
                exportData.toplam.toplamBrutMaas += hesap.oranliMaas;
                exportData.toplam.toplamNetMaas += hesap.netMaas;
                exportData.toplam.toplamIsverenMaliyet +=
                  hesap.toplamIsverenMaliyet;

                return {
                  isim: p.isim,
                  pozisyon: p.pozisyon,
                  brutMaas: p.brutMaas,
                  calistigiGun: p.calistigiGun,
                  netMaas: hesap.netMaas.toFixed(2),
                  isverenMaliyet: hesap.toplamIsverenMaliyet.toFixed(2),
                };
              }),
            };
          }
        });

        // JSON formatında indirme
        const dataStr = JSON.stringify(exportData, null, 2);
        const dataBlob = new Blob([dataStr], { type: 'application/json' });
        const url = URL.createObjectURL(dataBlob);
        const link = document.createElement('a');
        link.href = url;
        link.download = `hc-sigorta-export-${new Date().toISOString().split('T')[0]}.json`;
        link.click();
        URL.revokeObjectURL(url);

        addActivityLog(
          `Tüm veriler dışa aktarıldı (${exportData.toplam.personelSayisi} personel)`
        );
        alert(`✅ Veriler başarıyla dışa aktarıldı!
👥 ${exportData.toplam.personelSayisi} personel
💰 Toplam Net Maaş: ₺${exportData.toplam.toplamNetMaas.toFixed(0)}
📁 Dosya: hc-sigorta-export-${new Date().toISOString().split('T')[0]}.json`);
      }

      function editUser(userId) {
        // Demo kullanıcı bilgilerini al
        const users = {
          admin: {
            name: 'Sistem Yöneticisi',
            email: 'admin@hcsigorta.com',
            role: 'admin',
          },
          klinik: {
            name: 'HC Klinik Kullanıcısı',
            email: 'klinik@hcsigorta.com',
            role: 'user',
          },
          lab: {
            name: 'HC Lab Kullanıcısı',
            email: 'lab@hcsigorta.com',
            role: 'user',
          },
          eczane: {
            name: 'HC Eczane Kullanıcısı',
            email: 'eczane@hcsigorta.com',
            role: 'user',
          },
        };

        const user = users[userId];
        if (!user) {
          alert('Kullanıcı bulunamadı!');
          return;
        }

        const editForm = `
          <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; display: flex; justify-content: center; align-items: center;">
            <div style="background: white; padding: 30px; border-radius: 15px; max-width: 500px; width: 90%;">
              <h3 style="margin-bottom: 20px; color: #333;">✏️ Kullanıcı Düzenle: ${user.name}</h3>
              <form id="editUserForm">
                <div style="margin-bottom: 15px;">
                  <label style="display: block; margin-bottom: 5px; font-weight: 600;">Ad Soyad:</label>
                  <input type="text" id="editUserName" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px;" value="${user.name}" required>
                </div>
                <div style="margin-bottom: 15px;">
                  <label style="display: block; margin-bottom: 5px; font-weight: 600;">E-mail:</label>
                  <input type="email" id="editUserEmail" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px;" value="${user.email}" required>
                </div>
                <div style="margin-bottom: 15px;">
                  <label style="display: block; margin-bottom: 5px; font-weight: 600;">Yeni Şifre (boş bırakırsan değişmez):</label>
                  <input type="password" id="editUserPassword" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px;" placeholder="Yeni şifre">
                </div>
                <div style="margin-bottom: 20px;">
                  <label style="display: block; margin-bottom: 5px; font-weight: 600;">Yetki Seviyesi:</label>
                  <select id="editUserRole" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px;" ${userId === 'admin' ? 'disabled' : ''}>
                    <option value="user" ${user.role === 'user' ? 'selected' : ''}>Kullanıcı</option>
                    <option value="admin" ${user.role === 'admin' ? 'selected' : ''}>Yönetici</option>
                  </select>
                  ${userId === 'admin' ? '<small style="color: #666;">Ana admin yetkisi değiştirilemez</small>' : ''}
                </div>
                <div style="display: flex; gap: 10px;">
                  <button type="submit" class="btn" style="background: #3b82f6;">✅ Kaydet</button>
                  <button type="button" onclick="closeEditUserForm()" class="btn" style="background: #ef4444;">❌ İptal</button>
                </div>
              </form>
            </div>
          </div>
        `;

        document.body.insertAdjacentHTML('beforeend', editForm);

        document
          .getElementById('editUserForm')
          .addEventListener('submit', function (e) {
            e.preventDefault();

            const name = document.getElementById('editUserName').value;
            const email = document.getElementById('editUserEmail').value;
            const password = document.getElementById('editUserPassword').value;
            const role = document.getElementById('editUserRole').value;

            alert(`✅ Kullanıcı güncellendi:
👤 ${name}
📧 ${email}
🔑 ${role === 'admin' ? 'Yönetici' : 'Kullanıcı'}
${password ? '🔒 Şifre değiştirildi' : '🔒 Şifre değiştirilmedi'}

Kullanıcı bilgileri başarıyla güncellendi.`);

            addActivityLog(`${userId} kullanıcısı güncellendi: ${name}`);
            closeEditUserForm();
            loadUserManagement();
          });
      }

      function closeEditUserForm() {
        const form = document
          .querySelector('[id="editUserForm"]')
          .closest('div[style*="position: fixed"]');
        if (form) form.remove();
      }

      function deleteUser(userId) {
        if (userId === 'admin') {
          alert('Admin kullanıcısı silinemez!');
          return;
        }
        if (
          confirm(`${userId} kullanıcısını silmek istediğinizden emin misiniz?`)
        ) {
          alert(
            `${userId} kullanıcısı silme özelliği geliştirilme aşamasında...`
          );
          addActivityLog(`${userId} kullanıcısı silindi`);
        }
      }

      function editFirma(firmaKey) {
        const firma = firmaConfig[firmaKey];
        if (!firma) {
          alert('Firma bulunamadı!');
          return;
        }

        const editFirmaForm = `
          <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; display: flex; justify-content: center; align-items: center;">
            <div style="background: white; padding: 30px; border-radius: 15px; max-width: 500px; width: 90%;">
              <h3 style="margin-bottom: 20px; color: #333;">✏️ İşletme Düzenle: ${firma.name}</h3>
              <form id="editFirmaForm">
                <div style="margin-bottom: 15px;">
                  <label style="display: block; margin-bottom: 5px; font-weight: 600;">İşletme Adı:</label>
                  <input type="text" id="editFirmaName" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px;" value="${firma.name.replace(/^[^\s]+ /, '')}" required>
                </div>
                <div style="margin-bottom: 15px;">
                  <label style="display: block; margin-bottom: 5px; font-weight: 600;">İşletme Kodu:</label>
                  <input type="text" id="editFirmaKey" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px;" value="${firmaKey}" disabled>
                  <small style="color: #666;">İşletme kodu değiştirilemez</small>
                </div>
                <div style="margin-bottom: 15px;">
                  <label style="display: block; margin-bottom: 5px; font-weight: 600;">Renk Kodu:</label>
                  <input type="color" id="editFirmaColor" style="width: 100%; height: 40px; border: 2px solid #ddd; border-radius: 8px;" value="${firma.color}" required>
                </div>
                <div style="margin-bottom: 15px;">
                  <label style="display: block; margin-bottom: 5px; font-weight: 600;">İkon:</label>
                  <input type="text" id="editFirmaIcon" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px;" value="${firma.name.charAt(0)}" maxlength="2" required>
                </div>
                <div style="margin-bottom: 15px; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                  <strong>İstatistikler:</strong><br>
                  <small>👥 Personel Sayısı: ${firmaPersonelleri[firmaKey] ? firmaPersonelleri[firmaKey].length : 0}</small><br>
                  <small>📅 Oluşturulma: Demo Firma</small>
                </div>
                <div style="display: flex; gap: 10px;">
                  <button type="submit" class="btn" style="background: #3b82f6;">✅ Kaydet</button>
                  <button type="button" onclick="closeEditFirmaForm()" class="btn" style="background: #ef4444;">❌ İptal</button>
                </div>
              </form>
            </div>
          </div>
        `;

        document.body.insertAdjacentHTML('beforeend', editFirmaForm);

        document
          .getElementById('editFirmaForm')
          .addEventListener('submit', function (e) {
            e.preventDefault();

            const name = document.getElementById('editFirmaName').value;
            const color = document.getElementById('editFirmaColor').value;
            const icon = document.getElementById('editFirmaIcon').value;

            // Firma bilgilerini güncelle
            firmaConfig[firmaKey].name = `${icon} ${name}`;
            firmaConfig[firmaKey].color = color;

            alert(`✅ İşletme güncellendi:
🏢 ${name}
🎨 Renk: ${color}
${icon} İkon: ${icon}

İşletme bilgileri başarıyla güncellendi.`);

            addActivityLog(`${firmaKey} işletmesi güncellendi: ${name}`);
            closeEditFirmaForm();
            loadFirmaManagement();

            // Sekme butonlarını yenile
            createTabs();
          });
      }

      function closeEditFirmaForm() {
        const form = document
          .querySelector('[id="editFirmaForm"]')
          .closest('div[style*="position: fixed"]');
        if (form) form.remove();
      }

      function deleteFirma(firmaKey) {
        const personelSayisi = firmaPersonelleri[firmaKey]
          ? firmaPersonelleri[firmaKey].length
          : 0;
        if (personelSayisi > 0) {
          alert(
            `Bu firmada ${personelSayisi} personel var. Önce personelleri silin veya başka firmaya aktarın.`
          );
          return;
        }

        if (
          confirm(
            `${firmaConfig[firmaKey].name} firmasını silmek istediğinizden emin misiniz?`
          )
        ) {
          alert(`Firma silme özelliği geliştirilme aşamasında...`);
          addActivityLog(`${firmaConfig[firmaKey].name} firması silindi`);
        }
      }

      // Sayfa yüklendiğinde
      window.addEventListener('load', function () {
        // Login modalı göster
        document.getElementById('loginModal').classList.add('active');
      });
    </script>
  </body>
</html>
